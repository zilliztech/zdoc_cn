"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[7716],{8914:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>g,frontMatter:()=>l,metadata:()=>d,toc:()=>u});var a=t(7462),i=(t(7294),t(3905)),s=(t(3612),t(4866)),r=t(5162);const l={slug:"/docs/insert-entities",beta:!1,notebook:"00_quick_start.ipynb,01_use_customized_schema.ipynb",sidebar_position:1},o="\u63d2\u5165 Entity",d={unversionedId:"tutorials/collection/insert-update-and-delete/insert-entities",id:"tutorials/collection/insert-update-and-delete/insert-entities",title:"\u63d2\u5165 Entity",description:"\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u5c06 Entity \u63d2\u5165\u5230 Zilliz Cloud \u96c6\u7fa4\u4e2d\u7684 Collection\u3002",source:"@site/docs/tutorials/collection/insert-update-and-delete/insert-entities.md",sourceDirName:"tutorials/collection/insert-update-and-delete",slug:"/docs/insert-entities",permalink:"/docs/insert-entities",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{slug:"/docs/insert-entities",beta:!1,notebook:"00_quick_start.ipynb,01_use_customized_schema.ipynb",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"\u63d2\u5165\u3001\u66f4\u65b0\u53ca\u5220\u9664",permalink:"/insert-update-and-delete"},next:{title:"Upsert Entity",permalink:"/docs/upsert-entities"}},p={},u=[{value:"\u5f00\u59cb\u524d",id:"before-you-start",level:2},{value:"\u63d2\u5165 Entity",id:"insert-entities",level:2},{value:"\u51c6\u5907\u6570\u636e",id:"prepare-data",level:3},{value:"\u63d2\u5165\u6570\u636e",id:"insert-data",level:3},{value:"\u5199\u5165\u64cd\u4f5c",id:"understanding-flushing-data",level:2},{value:"\u76f8\u5173\u6587\u6863",id:"related-topics",level:2}],c={toc:u},m="wrapper";function g(e){let{components:n,...t}=e;return(0,i.kt)(m,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u63d2\u5165-entity"},"\u63d2\u5165 Entity"),(0,i.kt)("p",null,"\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u5c06 Entity \u63d2\u5165\u5230 Zilliz Cloud \u96c6\u7fa4\u4e2d\u7684 Collection\u3002"),(0,i.kt)("p",null,"Entity \u662f Collection \u4e2d\u7684\u57fa\u672c\u6570\u636e\u5355\u5143\u3002\u540c\u4e00\u4e2a Collection \u4e2d\u7684 Entity \u5177\u6709\u76f8\u540c\u7684\u5c5e\u6027\uff0c\u8fd9\u4e9b\u5c5e\u6027\u5171\u540c\u5b9a\u4e49\u5728 Schema \u4e2d\u3002"),(0,i.kt)("h2",{id:"before-you-start"},"\u5f00\u59cb\u524d"),(0,i.kt)("p",null,"\u8bf7\u786e\u4fdd\u5df2\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9aa4\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5df2\u521b\u5efa\u4e86\u76ee\u6807 Collection\u3002\u8be6\u60c5\u8bf7\u53c2\u89c1",(0,i.kt)("a",{parentName:"p",href:"./create-collection"},"\u521b\u5efa Collection"),"\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u60a8\u5df2\u7ecf\u4e0b\u8f7d\u4e86\u793a\u4f8b\u6570\u636e\u3002\u8be6\u60c5\u8bf7\u53c2\u89c1",(0,i.kt)("a",{parentName:"p",href:"./example-dataset"},"\u793a\u4f8b\u6570\u636e\u96c6"),"\u3002"))),(0,i.kt)("h2",{id:"insert-entities"},"\u63d2\u5165 Entity"),(0,i.kt)("h3",{id:"prepare-data"},"\u51c6\u5907\u6570\u636e"),(0,i.kt)("p",null,"\u5728\u5411 Collection \u63d2\u5165\u591a\u6761\u6570\u636e\u524d\uff0c\u53ef\u6309\u5982\u4e0b\u6b65\u9aa4\u51c6\u5907\u6570\u636e\u3002"),(0,i.kt)(s.Z,{groupId:"code",defaultValue:"python",values:[{label:"Python",value:"python"},{label:"NodeJS",value:"javascript"},{label:"Java",value:"java"},{label:"Go",value:"go"},{label:"Bash",value:"bash"}],mdxType:"Tabs"},(0,i.kt)(r.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'import json\n\n# (Continued)\n\nDATASET_PATH="../medium_articles_2020_dpr.json" # Set your dataset path\n\n# 6. Prepare data\n\n# Prepare a list of rows\nwith open(DATASET_PATH) as f:\n    data = json.load(f)\n    rows = data[\'rows\']\n\nprint(rows[0])\n\n# Output\n#\n# [\n#     {\n#         "id": 0,\n#         "title": "The Reported Mortality Rate of Coronavirus Is Not Important",\n#         "title_vector": [\n#             0.041732933,\n#             0.013779674,\n#             -0.027564144,\n#             -0.013061441,\n#             0.009748648,\n#             0.00082446384,\n#             -0.00071647146,\n#             0.048612226,\n#             -0.04836573,\n#             -0.04567751,\n#             0.018008126,\n#             0.0063936645,\n#             -0.011913628,\n#             0.030776596,\n#             -0.018274948,\n#             0.019929802,\n#             0.020547243,\n#             0.032735646,\n#             -0.031652678,\n#             -0.033816382,\n#             "(748 more items hidden)"\n#         ],\n#         "link": "https://medium.com/swlh/the-reported-mortality-rate-of-coronavirus-is-not-important-369989c8d912",\n#         "reading_time": 13,\n#         "publication": "The Startup",\n#         "claps": 1100,\n#         "responses": 18\n#     }\n# ]\n'))),(0,i.kt)(r.Z,{value:"javascript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const fs = require('fs');\nconst data_file = `./medium_articles_2020_dpr.json`\n\nasync function main () {\n\n    // (Continued)\n    \n    const data = JSON.parse(fs.readFileSync(data_file, \"utf8\"))\n\n    // read rows\n    const rows = data[\"rows\"]\n    const row = rows[0]\n\n    console.log(Object.keys(row))\n\n    // Output\n    // \n    // [\n    //   'id',\n    //   'title',\n    //   'title_vector',\n    //   'link',\n    //   'reading_time',\n    //   'publication',\n    //   'claps',\n    //   'responses'\n    // ]\n    //     \n\n}\n"))),(0,i.kt)(r.Z,{value:"java",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'public final class UseCustomizedSchemaDemo  {\n    public static void main(String[] args) {\n        \n        // (Continued)\n        \n        String data_file = "../medium_articles_2020_dpr.json";\n        \n        String content;\n\n        // read a local file\n        Path file = Path.of(data_file);\n        try {\n            content = Files.readString(file);\n        } catch (Exception e) {\n            System.err.println("Failed to read file: " + e.getMessage());\n            return;\n        }\n\n        System.out.println("Successfully read file");\n\n        // Output:\n        // Successfully read file\n        \n        // Load dataset\n        JSONObject dataset = JSON.parseObject(content);\n        List<JSONObject> rows = getRows(dataset.getJSONArray("rows"), 5979);\n        \n        // Also, you can get fields from dataset and insert them\n        // List<Field> fields = getFields(dataset.getJSONArray("rows"), 5979);\n    }\n    \n    public static List<JSONObject> getRows(JSONArray dataset, int counts) {\n        List<JSONObject> rows = new ArrayList<JSONObject>();\n        for (int i = 0; i < counts; i++) {\n            JSONObject row = dataset.getJSONObject(i);\n            List<Float> vectors = row.getJSONArray("title_vector").toJavaList(Float.class);\n            Long reading_time = row.getLong("reading_time");\n            Long claps = row.getLong("claps");\n            Long responses = row.getLong("responses");\n            row.put("title_vector", vectors);\n            row.put("reading_time", reading_time);\n            row.put("claps", claps);\n            row.put("responses", responses);\n            row.remove("id");\n            rows.add(row);\n        }\n        return rows;\n    }\n\n    public static List<Field> getFields(JSONArray dataset, int counts) {\n        List<Field> fields = new ArrayList<Field>();\n        List<String> titles = new ArrayList<String>();\n        List<List<Float>> title_vectors = new ArrayList<List<Float>>();\n        List<String> links = new ArrayList<String>();\n        List<Long> reading_times = new ArrayList<Long>();\n        List<String> publications = new ArrayList<String>();\n        List<Long> claps_list = new ArrayList<Long>();\n        List<Long> responses_list = new ArrayList<Long>();\n\n        for (int i = 0; i < counts; i++) {\n            JSONObject row = dataset.getJSONObject(i);\n            titles.add(row.getString("title"));\n            title_vectors.add(row.getJSONArray("title_vector").toJavaList(Float.class));\n            links.add(row.getString("link"));\n            reading_times.add(row.getLong("reading_time"));\n            publications.add(row.getString("publication"));\n            claps_list.add(row.getLong("claps"));\n            responses_list.add(row.getLong("responses"));\n        }\n\n        fields.add(new Field("title", titles));\n        fields.add(new Field("title_vector", title_vectors));\n        fields.add(new Field("link", links));\n        fields.add(new Field("reading_time", reading_times));\n        fields.add(new Field("publication", publications));\n        fields.add(new Field("claps", claps_list));\n        fields.add(new Field("responses", responses_list));\n\n        return fields;        \n    }\n}\n'))),(0,i.kt)(r.Z,{value:"go",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'func main() {\n\n        // (Continued)\n\n        // 6. Read the dataset\n        file, err := os.ReadFile("../../medium_articles_2020_dpr.json")\n        if err != nil {\n                log.Fatal("Failed to read file:", err.Error())\n        }\n\n        var data Dataset\n\n        if err := json.Unmarshal(file, &data); err != nil {\n                log.Fatal(err.Error())\n        }\n\n        fmt.Println("Dataset loaded, row number: ", len(data.Rows))\n        \n        rows := make([]interface{}, 0, 1)\n\n        for i := 0; i < len(data.Rows); i++ {\n                rows = append(rows, data.Rows[i])\n        }\n\n}\n\ntype Row struct {\n        ID          int64     `json:"id" milvus:"name:id"`\n        Title       string    `json:"title" milvus:"name:title"`\n        TitleVector []float32 `json:"title_vector" milvus:"name:title_vector"`\n        Link        string    `json:"link" milvus:"name:link"`\n        ReadingTime int64     `json:"reading_time" milvus:"name:reading_time"`\n        Publication string    `json:"publication" milvus:"name:publication"`\n        Claps       int64     `json:"claps" milvus:"name:claps"`\n        Responses   int64     `json:"responses" milvus:"name:responses"`\n}\n\ntype Dataset struct {\n        Rows []Row `json:"rows"`\n}\n'))),(0,i.kt)(r.Z,{value:"bash",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# read the first 100 records from the dataset\ndata=\"$(cat path/to/medium_articles_2020_dpr.json \\\n        | jq '.rows' \\\n        | jq '.[1:100]' \\\n        | jq -r '.[] | . + {\"vector\": .title_vector} | del(.title_vector) | del(.id)' \\\n        | jq -s -c '.')\"\n\n# This is commented out to avoid massive output in your console.\n# echo $data\n#\n# Output\n#\n# [\n#   {\n#      'id': 0,\n#      'title': 'The Reported Mortality Rate of Coronavirus Is Not Important',\n#      'vector': [0.041732933, 0.013779674, -0.027564144, ..., 0.030096486],\n#      'link': '<https://medium.com/swlh/the-reported-mortality-rate-of-coronavirus-is-not-important-369989c8d912>',\n#      'reading_time': 13,\n#      'publication': 'The Startup',\n#      'claps': 1100,\n#             'responses': 18\n#   },\n#   {\n#      'id': 1, \n#      'title': 'Dashboards in Python: 3 Advanced Examples for Dash Beginners and Everyone Else', \n#      'vector': [0.0039737443, 0.003020432, -0.0006188639, 0.03913546, ..., 0.021713957], \n#      'link': '<https://medium.com/swlh/dashboards-in-python-3-advanced-examples-for-dash-beginners-and-everyone-else-b1daf4e2ec0a>', \n#      'reading_time': 14, \n#      'publication': 'The Startup', \n#      'claps': 726, \n#      'responses': 3\n#   },\n#   ...\n# ]\n")))),(0,i.kt)("h3",{id:"insert-data"},"\u63d2\u5165\u6570\u636e"),(0,i.kt)("p",null,"\u5728\u6570\u636e\u51c6\u5907\u5b8c\u6bd5\u540e\uff0c\u5373\u53ef\u6309\u5982\u4e0b\u6b65\u9aa4\u63d2\u5165\u6570\u636e\u3002"),(0,i.kt)(s.Z,{groupId:"code",defaultValue:"python",values:[{label:"Python",value:"python"},{label:"NodeJS",value:"javascript"},{label:"Java",value:"java"},{label:"Go",value:"go"},{label:"Bash",value:"bash"}],mdxType:"Tabs"},(0,i.kt)(r.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)(s.Z,{groupId:"python",defaultValue:"python",values:[{label:"Starter API",value:"python"},{label:"Advanced API",value:"python_1"}],mdxType:"Tabs"},(0,i.kt)(r.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# Insert data using a MilvusClient object\nfrom pymilvus import MilvusClient\n\n# Insert multiple entities\nres = client.insert(\n  collection_name=COLLECTION_NAME,\n  data=rows\n)\n\nprint(res)\n\n# Output\n#\n# [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, "(5959 more items hidden)"]\n\n'))),(0,i.kt)(r.Z,{value:"python_1",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"# Insert data using a Collection object\nfrom pymilvus import Collection\n\nres = collection.insert(rows)\n\nprint(res.insert_count)\n\n# Output\n#\n# 5979\n"))))),(0,i.kt)(r.Z,{value:"javascript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"async function main () {\n\n    // (Continued)\n\n    //insert vectors\n    res = await client.insert({\n        collection_name: collectionName,\n        data: rows\n    })\n\n    console.log(res)\n\n    // Output\n    // \n    // {\n    //   succ_index: [\n    //      0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11,\n    //     12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,\n    //     24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,\n    //     36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,\n    //     48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59,\n    //     60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71,\n    //     72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83,\n    //     84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95,\n    //     96, 97, 98, 99,\n    //     ... 5879 more items\n    //   ],\n    //   err_index: [],\n    //   status: { error_code: 'Success', reason: '', code: 0 },\n    //   IDs: { int_id: { data: [Array] }, id_field: 'int_id' },\n    //   acknowledged: false,\n    //   insert_cnt: '5979',\n    //   delete_cnt: '0',\n    //   upsert_cnt: '0',\n    //   timestamp: '445316631681040387'\n    // }\n    // \n\n}\n"))),(0,i.kt)(r.Z,{value:"java",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'import io.milvus.param.*;\nimport io.milvus.response.MutationResultWrapper;\nimport io.milvus.grpc.MutationResult;\n\npublic class UseCustomizedSchemaDemo \n{\n    public static void main( String[] args )\n    {\n        // (Continued)\n        \n        InsertParam insertParam = InsertParam.newBuilder()\n            .withCollectionName(collectionName)\n            .withRows(rows)\n            // .withFields(fields)\n            .build();\n\n        R<MutationResult> insertResponse = client.insert(insertParam);\n\n        if (insertResponse.getStatus() != R.Status.Success.getCode()) {\n            System.err.println(insertResponse.getMessage());\n        }\n\n        MutationResultWrapper mutationResultWrapper = new MutationResultWrapper(insertResponse.getData());\n\n        System.out.println("Successfully insert entities: " + mutationResultWrapper.getInsertCount());   \n\n        // Output:\n        // Successfully insert entities: 5979\n    }\n}\n'))),(0,i.kt)(r.Z,{value:"go",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'func main() {\n\n        // (Continued)\n    \n         col, err := conn.InsertRows(context.Background(), COLLNAME, "", rows)\n\n        if err != nil {\n                log.Fatal("Failed to insert rows:", err.Error())\n        }\n\n        fmt.Println("Inserted entities: ", col.Len())   \n\n}\n'))),(0,i.kt)(r.Z,{value:"bash",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'# insert record \ncurl --request POST \\\n     --url "${PUBLIC_ENDPOINT}/v1/vector/insert" \\\n     --header "Authorization: Bearer ${API_KEY}" \\\n     --header \'accept: application/json\' \\\n     --header \'content-type: application/json\' \\\n     --data "{\n        \\"collectionName\\": \\"medium_articles_2020\\",\n        \\"data\\": ${data}\n    }"\n\n# Response\n#\n# {\n#     "code": 200,\n#     "data": {\n#         "insertCount": 99,\n#         "insertIds": [\n#             "442169042773493965",\n#             "442169042773493966"\uff0c\n#             ...\n#         ]\n#     }\n# }\n')))),(0,i.kt)("h2",{id:"understanding-flushing-data"},"\u5199\u5165\u64cd\u4f5c"),(0,i.kt)("p",null,"Zilliz Cloud \u4f1a\u5728\u63d2\u5165\u7684\u6570\u91cf\u5230\u8fbe\u4e00\u5b9a\u89c4\u6a21\u65f6\u81ea\u52a8\u6267\u884c\u5efa\u7acb\u7d22\u5f15\u548c\u5199\u5165\u64cd\u4f5c\u3002"),(0,i.kt)("p",null,"\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u65e0\u987b\u5728\u63d2\u5165\u4e00\u6279\u6570\u636e\u540e\u7acb\u5373\u624b\u52a8\u8c03\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"flush()"),"\u65b9\u6cd5\u3002\u4f46\u662f\u5982\u679c\u60a8\u9700\u8981\u5728\u63d2\u5165\u4e00\u6279\u6570\u636e\u540e\uff0c\u5e0c\u671b\u5728\u641c\u7d22\u7ed3\u679c\u4e2d\u80fd\u51c6\u786e\u5730\u67e5\u8be2\u5230\u8fd9\u6279\u6570\u636e\uff0c\u8c03\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"flush()"),"\u65b9\u6cd5\u53ef\u80fd\u4f1a\u662f\u4e00\u4e2a\u53ef\u4ee5\u8003\u8651\u7684\u65b9\u5f0f\u3002"),(0,i.kt)("p",null,"\u8be5\u65b9\u6cd5\u6240\u505a\u7684\u5c31\u662f\u5c06\u6570\u636e\u5b58\u5165\u4e00\u4e2a Segment \u4e2d\u5e76\u5c06\u8be5 Segment \u843d\u76d8\uff0c\u53ea\u6709\u843d\u76d8\u7684\u6570\u636e\u624d\u53ef\u4ee5\u901a\u8fc7\u7d22\u5f15\u68c0\u7d22\u5230\u3002\u5426\u5219\uff0c\u4f60\u53ef\u80fd\u5728\u63d2\u5165\u540e\u7acb\u5373\u6267\u884c\u7684\u67e5\u8be2\u7ed3\u679c\u4e2d\u770b\u4e0d\u5230\u8fd9\u4e9b\u65b0\u63d2\u5165\u7684\u8bb0\u5f55\u3002"),(0,i.kt)("p",null,"\u4f46\u662f\u8bf7\u8bb0\u4f4f\uff0c\u5bf9\u4e8e\u5927\u591a\u6570\u7528\u6237\u548c\u573a\u666f\u800c\u8a00\uff0c\u6ca1\u6709\u5fc5\u8981\u624b\u52a8\u8c03\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"flush()"),"\u65b9\u6cd5\u3002Zilliz Cloud \u4f1a\u5728\u9002\u5f53\u7684\u65f6\u5019\u81ea\u52a8\u6267\u884c\u8fd9\u4e00\u64cd\u4f5c\u3002"),(0,i.kt)("p",null,"\u5982\u679c\u9700\u8981\u7acb\u5373\u67e5\u8be2\u65b0\u63d2\u5165\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u9009\u62e9\u624b\u52a8\u6267\u884c\u5199\u5165\u64cd\u4f5c\u3002"),(0,i.kt)("h2",{id:"related-topics"},"\u76f8\u5173\u6587\u6863"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"./search-query-and-get"},"\u5411\u91cf\u641c\u7d22\u548c\u67e5\u8be2")," ")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"./data-security"},"\u6570\u636e\u5b89\u5168")," ")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"./enable-dynamic-schema"},"\u5f00\u542f\u52a8\u6001 Schema")," ")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"./javascript-object-notation-json"},"\u4f7f\u7528 JSON \u7c7b\u578b\u5b57\u6bb5")))))}g.isMDXComponent=!0}}]);