"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[5181],{2946:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>u});var a=t(7462),i=(t(7294),t(3905)),l=(t(3612),t(4866)),o=t(5162);const r={slug:"/docs/enable-dynamic-schema",beta:!1,notebook:"02_enable_dynamic_schema.ipynb",sidebar_position:1},c="\u5f00\u542f\u52a8\u6001 Schema",s={unversionedId:"tutorials/collection/advanced-features/enable-dynamic-schema",id:"tutorials/collection/advanced-features/enable-dynamic-schema",title:"\u5f00\u542f\u52a8\u6001 Schema",description:"Schema \u5bf9\u4e8e Zilliz Cloud \u96c6\u7fa4\u7684\u6570\u636e\u5904\u7406\u975e\u5e38\u91cd\u8981\u3002\u5728\u5411 Collection \u4e2d\u63d2\u5165 Entity \u524d\uff0c\u9700\u8981\u5148\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u8bbe\u8ba1 Schema\uff0c\u5e76\u786e\u4fdd\u6240\u6709\u5f85\u63d2\u5165\u7684 Entity \u7684\u7ed3\u6784\u90fd\u4e0e\u8bbe\u8ba1\u597d\u7684 Schema \u76f8\u5339\u914d\u3002\u5982\u679c\u4e1a\u52a1\u9700\u6c42\u53d1\u751f\u53d8\u5316\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9700\u8981\u91cd\u65b0\u8bbe\u8ba1 Schema\u3002",source:"@site/docs/tutorials/collection/advanced-features/enable-dynamic-schema.md",sourceDirName:"tutorials/collection/advanced-features",slug:"/docs/enable-dynamic-schema",permalink:"/docs/enable-dynamic-schema",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{slug:"/docs/enable-dynamic-schema",beta:!1,notebook:"02_enable_dynamic_schema.ipynb",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"\u9ad8\u7ea7\u529f\u80fd",permalink:"/advanced-features"},next:{title:"\u4f7f\u7528 Partition Key",permalink:"/docs/use-partition-key"}},d={},u=[{value:"\u4e3a Collection \u5f00\u542f\u52a8\u6001 Schema",id:"create-collection-with-dynamic-schema-enabled",level:2},{value:"\u52a8\u6001\u63d2\u5165\u6570\u636e",id:"insert-dynamic-data",level:2},{value:"\u51c6\u5907\u6570\u636e",id:"prepare-data",level:3},{value:"\u63d2\u5165\u6570\u636e",id:"insert-data",level:3},{value:"\u4f7f\u7528\u52a8\u6001\u5b57\u6bb5\u641c\u7d22",id:"search-with-dynamic-fields",level:2},{value:"\u76f8\u5173\u6587\u6863",id:"related-topics",level:2}],p={toc:u},m="wrapper";function h(e){let{components:n,...t}=e;return(0,i.kt)(m,(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u5f00\u542f\u52a8\u6001-schema"},"\u5f00\u542f\u52a8\u6001 Schema"),(0,i.kt)("p",null,"Schema \u5bf9\u4e8e Zilliz Cloud \u96c6\u7fa4\u7684\u6570\u636e\u5904\u7406\u975e\u5e38\u91cd\u8981\u3002\u5728\u5411 Collection \u4e2d\u63d2\u5165 Entity \u524d\uff0c\u9700\u8981\u5148\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u8bbe\u8ba1 Schema\uff0c\u5e76\u786e\u4fdd\u6240\u6709\u5f85\u63d2\u5165\u7684 Entity \u7684\u7ed3\u6784\u90fd\u4e0e\u8bbe\u8ba1\u597d\u7684 Schema \u76f8\u5339\u914d\u3002\u5982\u679c\u4e1a\u52a1\u9700\u6c42\u53d1\u751f\u53d8\u5316\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9700\u8981\u91cd\u65b0\u8bbe\u8ba1 Schema\u3002"),(0,i.kt)("p",null,"\u52a8\u6001 Schema \u7684\u5f15\u5165\u4f7f\u5f97\u7528\u6237\u80fd\u591f\u5728\u4e0d\u4fee\u6539\u73b0\u6709 Schema \u7684\u524d\u63d0\u4e0b\uff0c\u5c06\u5e26\u6709\u65b0\u5b57\u6bb5\u7684 Entity \u63d2\u5165\u5230 Collection\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f00\u542f\u52a8\u6001 Schema \u540e\uff0c\u60a8\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539 Schema \u7684\u60c5\u51b5\u4e0b\uff0c\u76f4\u63a5\u5411 Collection \u63d2\u5165\u672a\u5b9a\u4e49\u7684\u5b57\u6bb5\u5373\u53ef\u3002"),(0,i.kt)("p",null,"\u52a8\u6001 Schema \u4f7f\u5f97\u6570\u636e\u5904\u7406\u66f4\u52a0\u7075\u6d3b\uff0c\u7528\u6237\u80fd\u591f\u5728 Collection \u4e2d\u5b58\u50a8\u548c\u68c0\u7d22\u590d\u6742\u7ed3\u6784\u7684\u6570\u636e\uff0c\u5305\u62ec\u5d4c\u5957\u6570\u636e\u3001\u6570\u7ec4\u4ee5\u53ca\u5176\u4ed6\u590d\u6742\u6570\u636e\u7c7b\u578b\u3002"),(0,i.kt)("h2",{id:"create-collection-with-dynamic-schema-enabled"},"\u4e3a Collection \u5f00\u542f\u52a8\u6001 Schema"),(0,i.kt)("p",null,"\u8981\u4e3a Collection \u5f00\u542f\u52a8\u6001 Schema\uff0c\u9700\u8981\u5728\u5b9a\u4e49 Schema \u65f6\u5c06 ",(0,i.kt)("inlineCode",{parentName:"p"},"enable_dynamic_field")," \u8bbe\u7f6e\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"True"),"\u3002\u5f00\u542f\u52a8\u6001 Schema \u540e\uff0c\u4e4b\u540e\u63d2\u5165\u7684 Entity \u4e2d\u7684\u6240\u6709\u672a\u5b9a\u4e49\u5b57\u6bb5\u5c06\u4ee5\u952e\u503c\u5bf9\u7684\u5f62\u5f0f\u5b58\u5165 Collection\u3002\u6211\u4eec\u5c06\u7528\u201c\u52a8\u6001\u5b57\u6bb5\u201d\u6765\u6307\u4ee3\u8fd9\u4e9b\u952e\u503c\u5bf9\u3002"),(0,i.kt)("p",null,"\u548c\u9884\u5148\u5b9a\u4e49\u7684\u5b57\u6bb5\u4e00\u6837\uff0c\u60a8\u53ef\u4ee5\u8981\u6c42 Zilliz Cloud \u5728\u641c\u7d22\u6216\u67e5\u8be2\u7ed3\u679c\u4e2d\u8f93\u51fa\u52a8\u6001\u5b57\u6bb5\uff0c\u4e5f\u53ef\u4ee5\u5728\u5e03\u5c14\u8868\u8fbe\u5f0f\u4e2d\u5f15\u7528\u52a8\u6001\u5b57\u6bb5\u3002"),(0,i.kt)("p",null,"\u5728\u6267\u884c\u5982\u4e0b\u4ee3\u7801\u4e4b\u524d\uff0c\u8bf7\u786e\u8ba4\u5df2\u8fde\u63a5\u81f3\u60a8\u7684\u96c6\u7fa4\u3002\u5982\u9700\u8fde\u63a5\u96c6\u7fa4\uff0c\u53ef\u53c2\u8003",(0,i.kt)("a",{parentName:"p",href:"./connect-to-cluster"},"\u8fde\u63a5\u96c6\u7fa4"),"\u3002"),(0,i.kt)(l.Z,{groupId:"code",defaultValue:"python",values:[{label:"Python",value:"python"},{label:"NodeJS",value:"javascript"},{label:"Java",value:"java"},{label:"Go",value:"go"}],mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'import json, os, time\nfrom pymilvus import connections, FieldSchema, CollectionSchema, DataType, Collection, utility\n\nCLUSTER_ENDPOINT="YOUR_CLUSTER_ENDPOINT" # Set your cluster endpoint\nTOKEN="YOUR_CLUSTER_TOKEN" # Set your token\nCOLLECTION_NAME="medium_articles_2020" # Set your collection name\nDATASET_PATH="{}/../medium_articles_2020_dpr.json".format(os.path.dirname(__file__)) # Set your dataset path\n\n# 1. Connect to cluster\nconnections.connect(\n  alias=\'default\', \n  #  Public endpoint obtained from Zilliz Cloud\n  uri=CLUSTER_ENDPOINT,\n  # API key or a colon-separated cluster username and password\n  token=TOKEN, \n)\n\n# 2. Define fields\nfields = [\n    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True, auto_id=True, max_length=100),\n    FieldSchema(name="title", dtype=DataType.VARCHAR, max_length=512),\n    FieldSchema(name="title_vector", dtype=DataType.FLOAT_VECTOR, dim=768)\n]\n\n# 3. Create schema with dynamic field enabled\nschema = CollectionSchema(\n    fields,\n    "The schema for a medium news collection",\n    enable_dynamic_field=True\n)\n\n# 4. Create collection\ncollection = Collection(COLLECTION_NAME, schema)\n\n# 5. Index collection\nindex_params = {\n    "index_type": "AUTOINDEX",\n    "metric_type": "L2",\n    "params": {}\n}\n\ncollection.create_index(\n  field_name="title_vector", \n  index_params=index_params\n)\n\ncollection.load()\n\n# Get loading progress\nprogress = utility.loading_progress(COLLECTION_NAME)\n\nprint(progress)\n\n# Output\n#\n# {\n#     "loading_progress": "100%"\n# }\n'))),(0,i.kt)(o.Z,{value:"javascript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const fs = require("fs")\nconst { MilvusClient, DataType, sleep } = require("@zilliz/milvus2-sdk-node")\n\nconst address = "YOUR_CLUSTER_ENDPOINT"\nconst token = "YOUR_CLUSTER_TOKEN"\nconst collectionName = "medium_articles_2020"\nconst data_file = `./medium_articles_2020_dpr.json`\n\nasync function main() {\n    // 1. Connect to cluster\n    const client = new MilvusClient({address, token})\n    \n    // 2. Define fields\n    fields = [\n        {\n            name: "id",\n            data_type: DataType.Int64,\n            is_primary_key: true,\n            auto_id: true\n        },\n        {\n            name: "title",\n            data_type: DataType.VarChar,\n            max_length: 512\n        },\n        {\n            name: "title_vector",\n            data_type: DataType.FloatVector,\n            dim: 768\n        },\n    ]\n    \n    // 3. Create collection\n    res = await client.createCollection({\n        collection_name: collectionName,\n        fields: fields,\n        enable_dynamic_field: true\n    })\n\n    console.log(res)\n\n    // Output\n    // \n    // { error_code: \'Success\', reason: \'\', code: 0 }\n    // \n\n    // 4. Create index\n    res = await client.createIndex({\n        collection_name: collectionName,\n        field_name: "title_vector",\n        index_type: "IVF_FLAT",\n        metric_type: "L2",\n        params: {\n            nlist: 1024\n        }\n    })\n\n    console.log(res)\n\n    // Output\n    // \n    // { error_code: \'Success\', reason: \'\', code: 0 }\n    // \n\n    res = await client.loadCollection({\n        collection_name: collectionName\n    })\n\n    console.log(res)    \n\n    // Output\n    // \n    // { error_code: \'Success\', reason: \'\', code: 0 }\n'))),(0,i.kt)(o.Z,{value:"java",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'package com.zilliz.docs;\n\nimport io.milvus.client.*;\nimport io.milvus.param.*;\nimport io.milvus.param.collection.FieldType;\nimport io.milvus.param.index.CreateIndexParam;\nimport io.milvus.param.collection.CreateCollectionParam;\nimport io.milvus.param.collection.DropCollectionParam;\nimport io.milvus.grpc.DataType;\nimport io.milvus.param.dml.InsertParam;\nimport io.milvus.grpc.MutationResult;\nimport io.milvus.response.MutationResultWrapper;\nimport io.milvus.param.dml.SearchParam;\nimport io.milvus.grpc.SearchResults;\nimport io.milvus.response.SearchResultsWrapper;\nimport io.milvus.param.collection.LoadCollectionParam;\n\nimport com.alibaba.fastjson.JSON;\nimport com.alibaba.fastjson.JSONArray;\nimport com.alibaba.fastjson.JSONObject;\n\nimport java.util.List;\nimport java.util.ArrayList;\nimport java.nio.file.Files;\nimport java.nio.file.Path;\n\n/**\n * Hello world!\n */\npublic final class EnableDynamicSchemaDemo {\n    private EnableDynamicSchemaDemo() {\n    }\n\n    /**\n     * Says hello to the world.\n     * @param args The arguments of the program.\n     */\n    public static void main(String[] args) {\n        String clusterEndpoint = "YOUR_CLUSTER_ENDPOINT";\n        String token = "YOUR_CLUSTER_TOKEN";\n        String collectionName = "medium_articles";\n        String data_file = System.getProperty("user.dir") + "/medium_articles_2020_dpr.json";\n\n        // 1. Connect to Zilliz Cloud cluster\n        ConnectParam connectParam = ConnectParam.newBuilder()\n            .withUri(clusterEndpoint)\n            .withToken(token)\n            .build();\n\n        MilvusServiceClient client = new MilvusServiceClient(connectParam);\n\n        System.out.println("Connected to Zilliz Cloud!");\n\n        // Output:\n        // Connected to Zilliz Cloud!\n\n        // 2. Define fields\n\n        FieldType id = FieldType.newBuilder()\n            .withName("id")\n            .withDataType(DataType.Int64)\n            .withPrimaryKey(true)\n            .withAutoID(true)\n            .build();\n\n        FieldType title = FieldType.newBuilder()\n            .withName("title")\n            .withDataType(DataType.VarChar)\n            .withMaxLength(512)\n            .build();\n\n        FieldType title_vector = FieldType.newBuilder()\n            .withName("title_vector")\n            .withDataType(DataType.FloatVector)\n            .withDimension(768)\n            .build();\n\n        // 3. Create collection\n\n        CreateCollectionParam createCollectionParam = CreateCollectionParam.newBuilder()\n            .withCollectionName(collectionName)\n            .withDescription("Schema of Medium articles")\n            .addFieldType(id)\n            .addFieldType(title)\n            .addFieldType(title_vector)\n            // Enable dynamic schema\n            .withEnableDynamicField(true)\n            .build();\n\n        R<RpcStatus> collection = client.createCollection(createCollectionParam);\n\n        if (collection.getException() != null) {\n            System.err.println("Failed to create collection: " + collection.getException().getMessage());\n            return;\n        }\n\n        System.out.println("Collection created!");\n\n        // Output:\n        // Collection created!\n\n        // 4. Create index\n\n        CreateIndexParam createIndexParam = CreateIndexParam.newBuilder()\n            .withCollectionName(collectionName)\n            .withFieldName("title_vector")\n            .withIndexName("title_vector_index")\n            .withIndexType(IndexType.AUTOINDEX)\n            .withMetricType(MetricType.L2)\n            .build();\n\n        R<RpcStatus> res = client.createIndex(createIndexParam);\n\n        if (res.getException() != null) {\n            System.err.println("Failed to create index: " + res.getException().getMessage());\n            return;\n        }\n\n        System.out.println("Index created!");\n\n        // Output:\n        // Index created!\n\n        // 5. Load collection\n\n        LoadCollectionParam loadCollectionParam = LoadCollectionParam.newBuilder()\n            .withCollectionName(collectionName)\n            .build();\n\n        R<RpcStatus> loadCollectionRes = client.loadCollection(loadCollectionParam);\n\n        if (loadCollectionRes.getException() != null) {\n            System.err.println("Failed to load collection: " + loadCollectionRes.getException().getMessage());\n            return;\n        }\n\n        System.out.println("Collection loaded!");\n\n        // Output:\n        // Collection loaded!\n'))),(0,i.kt)(o.Z,{value:"go",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'import "github.com/milvus-io/milvus-sdk-go/v2/entity"\n\n// You should include the following in the main function\n\n// 1. Connect to cluster\n\nconnParams := client.Config{\n    Address: CLUSTER_ENDPOINT,\n    APIKey:  TOKEN,\n}\n\nconn, err := client.NewClient(context.Background(), connParams)\n\nif err != nil {\n    log.Fatal("Failed to connect to Zilliz Cloud:", err.Error())\n}\n\n// 2. Create collection\n\n// Define fields\nid := entity.NewField().\n    WithName("id").\n    WithDataType(entity.FieldTypeInt64).\n    WithIsPrimaryKey(true)\n\ntitle := entity.NewField().\n    WithName("title").\n    WithDataType(entity.FieldTypeVarChar).\n    WithMaxLength(512)\n\ntitle_vector := entity.NewField().\n    WithName("title_vector").\n    WithDataType(entity.FieldTypeFloatVector).\n    WithDim(768)\n\n// Define schema\nschema := &entity.Schema{\n    CollectionName: COLLNAME,\n    AutoID:         true,\n    Fields: []*entity.Field{\n        id,\n        title,\n        title_vector,\n    },\n    EnableDynamicField: true,\n}\n\nerr = conn.CreateCollection(context.Background(), schema, 2)\n\nif err != nil {\n    log.Fatal("Failed to create collection:", err.Error())\n}\n\n// 3. Create index for cluster\nindex, err := entity.NewIndexAUTOINDEX(entity.MetricType("L2"))\n\nif err != nil {\n    log.Fatal("Failed to prepare the index:", err.Error())\n}\n\nfmt.Println(index.Name())\n\n// Output: \n//\n// AUTOINDEX\n\nerr = conn.CreateIndex(context.Background(), COLLNAME, "title_vector", index, false)\n\nif err != nil {\n    log.Fatal("Failed to create the index:", err.Error())\n}\n\n// 4. Load collection\nloadCollErr := conn.LoadCollection(context.Background(), COLLNAME, false)\n\nif loadCollErr != nil {\n    log.Fatal("Failed to load collection:", loadCollErr.Error())\n}\n\n// 5. Get load progress\nprogress, err := conn.GetLoadingProgress(context.Background(), COLLNAME, nil)\n\nif err != nil {\n    log.Fatal("Failed to get loading progress:", err.Error())\n}\n\nfmt.Println("Loading progress:", progress)\n\n// Output: \n//\n// Loading progress: 100\n')))),(0,i.kt)("h2",{id:"insert-dynamic-data"},"\u52a8\u6001\u63d2\u5165\u6570\u636e"),(0,i.kt)("p",null,"Collection \u521b\u5efa\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u5f00\u59cb\u52a8\u6001\u63d2\u5165\u6570\u636e\u3002"),(0,i.kt)("h3",{id:"prepare-data"},"\u51c6\u5907\u6570\u636e"),(0,i.kt)("p",null,"\u73b0\u5728\uff0c\u6211\u4eec\u9700\u8981\u4ece",(0,i.kt)("a",{parentName:"p",href:"./example-dataset"},"\u793a\u4f8b\u6570\u636e\u96c6"),"\u4e2d\u8bfb\u53d6\u6570\u636e\u3002"),(0,i.kt)(l.Z,{groupId:"code",defaultValue:"python",values:[{label:"Python",value:"python"},{label:"NodeJS",value:"javascript"},{label:"Java",value:"java"},{label:"Go",value:"go"}],mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"# 6. Prepare data\nwith open(DATASET_PATH) as f:\n    data = json.load(f)\n    list_of_rows = data['rows']\n\n    data_rows = []\n    for row in list_of_rows:\n        # Remove the id field because the primary key has auto_id enabled.\n        del row['id']\n        # Other keys except the title and title_vector fields in the row \n        # will be treated as dynamic fields.\n        data_rows.append(row)\n"))),(0,i.kt)(o.Z,{value:"javascript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"// You should include the following in the async function declaration\n\n// 5. prepare data\nconst data = JSON.parse(fs.readFileSync(data_file, {encoding: \"utf-8\"}))\n\n// read rows\nconst rows = data[\"rows\"]\nconst row = rows[0]\n\nconsole.log(Object.keys(row))\n\n// Output\n// \n// [\n//   'id',\n//   'title',\n//   'title_vector',\n//   'link',\n//   'reading_time',\n//   'publication',\n//   'claps',\n//   'responses'\n// ]\n// \n"))),(0,i.kt)(o.Z,{value:"java",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'// You should include the following in the main function\n\n// 5. prepare data\nString content;\n\n// read a local file\nPath file = Path.of(data_file);\ntry {\n    content = Files.readString(file);\n} catch (Exception e) {\n    System.err.println("Failed to read file: " + e.getMessage());\n    return;\n}\n\nSystem.out.println("Successfully read file");\n\n// Output:\n// Successfully read file\n'))),(0,i.kt)(o.Z,{value:"go",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'// You should include the following in the main function\n\n// 6. Read the dataset\nfile, err := os.ReadFile(DATA_FILE)\nif err != nil {\n    log.Fatal("Failed to read file:", err.Error())\n}\n\nvar data Dataset\n\nif err := json.Unmarshal(file, &data); err != nil {\n    log.Fatal(err.Error())\n}\n\nfmt.Println("Dataset loaded, row number: ", len(data.Rows))\n\n// Output: \n//\n// Dataset loaded, row number:  5979\n')))),(0,i.kt)("h3",{id:"insert-data"},"\u63d2\u5165\u6570\u636e"),(0,i.kt)("p",null,"\u6570\u636e\u51c6\u5907\u5b8c\u6210\u540e\u4fbf\u53ef\u4ee5\u5f00\u59cb\u63d2\u5165\u6570\u636e\uff1a"),(0,i.kt)(l.Z,{groupId:"code",defaultValue:"python",values:[{label:"Python",value:"python"},{label:"NodeJS",value:"javascript"},{label:"Java",value:"java"},{label:"Go",value:"go"}],mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# 7. Insert data\nresult = collection.insert(data_rows)\ncollection.flush()\n\nprint(f"Data inserted successfully! Inserted counts: {result.insert_count}")\n\n# Output\n#\n# Data inserted successfully! Inserted counts: 5979\n'))),(0,i.kt)(o.Z,{value:"javascript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"// You should include the following in the async function declaration\n\n// 6. insert data\nres = await client.insert({\n    collection_name: collectionName,\n    data: rows\n})\n\nconsole.log(res)\n\n// Output\n// \n// {\n//   succ_index: [\n//      0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11,\n//     12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,\n//     24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,\n//     36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,\n//     48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59,\n//     60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71,\n//     72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83,\n//     84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95,\n//     96, 97, 98, 99,\n//     ... 5879 more items\n//   ],\n//   err_index: [],\n//   status: { error_code: 'Success', reason: '', code: 0 },\n//   IDs: { int_id: { data: [Array] }, id_field: 'int_id' },\n//   acknowledged: false,\n//   insert_cnt: '5979',\n//   delete_cnt: '0',\n//   upsert_cnt: '0',\n//   timestamp: '445316728739856387'\n// }\n// \n\nawait sleep(5000)\n"))),(0,i.kt)(o.Z,{value:"java",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'// You should include the following in the main function\n\n// Load dataset\nJSONObject dataset = JSON.parseObject(content);\n\n// Insert your data in rows, all the fields not pre-defined in the schema \n// are recognized as pre-defined schema\nList<JSONObject> rows = getRows(dataset.getJSONArray("rows"), 1000);\n\nInsertParam insertParam = InsertParam.newBuilder()\n    .withCollectionName(collectionName)\n    .withRows(rows)\n    .build();\n\nR<MutationResult> insertResponse = client.insert(insertParam);\n\nif (insertResponse.getStatus() != R.Status.Success.getCode()) {\n    System.err.println(insertResponse.getMessage());\n}\n\nMutationResultWrapper mutationResultWrapper = new MutationResultWrapper(insertResponse.getData());\n\nSystem.out.println("Successfully insert entities: " + mutationResultWrapper.getInsertCount());  \n\n// Output:\n// Successfully insert entities: 1000\n\n// wait for a while\ntry {\n    // pause execution for 5 seconds\n    Thread.sleep(5000);\n} catch (InterruptedException e) {\n    // handle the exception\n    Thread.currentThread().interrupt();\n} \n'))),(0,i.kt)(o.Z,{value:"go",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'// You should include the following in the main function\n\n// 6. Insert data\nfmt.Println("Start inserting ...")\n\n// Output: \n//\n// Start inserting ...\n\nrows := make([]interface{}, 0, 1)\n\nfor i := 0; i < len(data.Rows); i++ {\n    rows = append(rows, data.Rows[i])\n}\n\ncol, err := conn.InsertRows(context.Background(), COLLNAME, "", rows)\n\nif err != nil {\n    log.Fatal("Failed to insert rows:", err.Error())\n}\n\nfmt.Println("Inserted entities: ", col.Len())\n\n// Output: \n//\n// Inserted entities:  5979\n\ntime.Sleep(5 * time.Second)\n')))),(0,i.kt)("h2",{id:"search-with-dynamic-fields"},"\u4f7f\u7528\u52a8\u6001\u5b57\u6bb5\u641c\u7d22"),(0,i.kt)("p",null,"\u5047\u8bbe\u524d\u9762\u7684\u6240\u6709\u6b65\u9aa4\u90fd\u5df2\u5b8c\u6210\uff0c\u6b64\u65f6\u6211\u4eec\u4fbf\u53ef\u4ee5\u5728\u641c\u7d22\u6216\u67e5\u8be2\u7684\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u52a8\u6001\u5b57\u6bb5\uff1a"),(0,i.kt)(l.Z,{groupId:"code",defaultValue:"python",values:[{label:"Python",value:"python"},{label:"NodeJS",value:"javascript"},{label:"Java",value:"java"},{label:"Go",value:"go"}],mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# 8. Search data\nresult = collection.search(\n    data=[data_rows[0][\'title_vector\']],\n    anns_field="title_vector",\n    param={"metric_type": "L2", "params": {"nprobe": 10}},\n    limit=3,\n    # Access dynamic fields in the boolean expression\n    expr=\'claps > 30 and reading_time < 10\',\n    # Include dynamic fields in the output to return\n    output_fields=["title", "reading_time", "claps"],\n)\n\nresult = [ list(map(lambda y: y.entity.to_dict(), x)) for x in result ]\n\nprint(result)\n\n# Output\n#\n# [\n#     [\n#         {\n#             "id": 443943328732915404,\n#             "distance": 0.36103835701942444,\n#             "entity": {\n#                 "title": "The Hidden Side Effect of the Coronavirus",\n#                 "reading_time": 8,\n#                 "claps": 83\n#             }\n#         },\n#         {\n#             "id": 443943328732915438,\n#             "distance": 0.37674015760421753,\n#             "entity": {\n#                 "title": "Why The Coronavirus Mortality Rate is Misleading",\n#                 "reading_time": 9,\n#                 "claps": 2900\n#             }\n#         },\n#         {\n#             "id": 443943328732913238,\n#             "distance": 0.4162980318069458,\n#             "entity": {\n#                 "title": "Coronavirus shows what ethical Amazon could look like",\n#                 "reading_time": 4,\n#                 "claps": 51\n#             }\n#         }\n#     ]\n# ]\n\n# get collection info\nprint("Entity counts: ", collection.num_entities)\n\n# Output\n#\n# Entity counts:  5979\n'))),(0,i.kt)(o.Z,{value:"javascript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"res = await client.search({\n    collection_name: collectionName,\n    vector: rows[0].title_vector,\n    limit: 3,\n    filter: \"claps > 30 and reading_time < 10\",\n    output_fields: [\"title\", \"link\"]\n});\n\nconsole.log(res);\n\n// Output\n// \n// {\n//   status: { error_code: 'Success', reason: '', code: 0 },\n//   results: [\n//     {\n//       score: 0.36103832721710205,\n//       id: '5607',\n//       link: 'https://medium.com/swlh/the-hidden-side-effect-of-the-coronavirus-b6a7a5ee9586',\n//       title: 'The Hidden Side Effect of the Coronavirus'\n//     },\n//     {\n//       score: 0.37674015760421753,\n//       id: '5641',\n//       link: 'https://towardsdatascience.com/why-the-coronavirus-mortality-rate-is-misleading-cc63f571b6a6',\n//       title: 'Why The Coronavirus Mortality Rate is Misleading'\n//     },\n//     {\n//       score: 0.416297972202301,\n//       id: '3441',\n//       link: 'https://medium.com/swlh/coronavirus-shows-what-ethical-amazon-could-look-like-7c80baf2c663',\n//       title: 'Coronavirus shows what ethical Amazon could look like'\n//     }\n//   ]\n// }\n// \n\n// 7. Get collection info\n\nres = await client.describeCollection({\n    collection_name: collectionName\n})\n\nconsole.log(res);\n\n// Output\n// \n// {\n//   virtual_channel_names: [ 'by-dev-rootcoord-dml_11_445311585782773304v0' ],\n//   physical_channel_names: [ 'by-dev-rootcoord-dml_11' ],\n//   aliases: [],\n//   start_positions: [],\n//   properties: [],\n//   status: { error_code: 'Success', reason: '', code: 0 },\n//   schema: {\n//     fields: [ [Object], [Object], [Object] ],\n//     name: 'medium_articles_2020',\n//     description: '',\n//     autoID: false,\n//     enable_dynamic_field: true\n//   },\n//   collectionID: '445311585782773304',\n//   created_timestamp: '445316708672733190',\n//   created_utc_timestamp: '1698748430911',\n//   shards_num: 1,\n//   consistency_level: 'Bounded',\n//   collection_name: 'medium_articles_2020',\n//   db_name: 'default',\n//   num_partitions: '1'\n// }\n// \n"))),(0,i.kt)(o.Z,{value:"java",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'// prepare query vector\n\nList<List<Float>> queryVectors = new ArrayList<>();\nList<Float> queryVector1 = rows.get(0).getJSONArray("title_vector").toJavaList(Float.class);\nqueryVectors.add(queryVector1);\n\nList<String> outputFields = new ArrayList<>();\noutputFields.add("title");\n// The following two fields are dynamic fields.\noutputFields.add("claps");\noutputFields.add("reading_time");\n\n// Search vectors in a collection\n\nSearchParam searchParam = SearchParam.newBuilder()\n    .withCollectionName(collectionName)\n    .withVectorFieldName("title_vector")\n    .withVectors(queryVectors)\n    .withTopK(5)   \n    .withMetricType(MetricType.L2)  \n    .withParams("{\\"nprobe\\":10,\\"offset\\":2, \\"limit\\":3}")\n    .withOutFields(outputFields)\n    .withExpr("$meta[\\"claps\\"] > 30 and reading_time < 10")\n    .build();\n\nR<SearchResults> response = client.search(searchParam);\n\nSearchResultsWrapper wrapper = new SearchResultsWrapper(response.getData().getResults());\n\nList<List<JSONObject>> results = new ArrayList<>();\n\nfor (int i = 0; i < queryVectors.size(); ++i) {\n    List<SearchResultsWrapper.IDScore> scores = wrapper.getIDScore(i);\n    List<JSONObject> entities = new ArrayList<>();\n    for (int j = 0; j < scores.size(); ++j) {\n        SearchResultsWrapper.IDScore score = scores.get(j);\n        JSONObject entity = new JSONObject();\n        entity.put("id", score.getLongID());\n        entity.put("distance", score.getScore());\n        entity.put("title", scores.get(j).get("title"));\n        // The following are dynamic fields.\n        entity.put("claps", scores.get(j).get("claps"));\n        entity.put("reading_time", scores.get(j).get("reading_time"));\n        entities.add(entity);\n    }\n    \n    results.add(entities);\n}\n\nSystem.out.println(results);\n\n// Output:\n// [[\n//     {\n//         "reading_time": 6,\n//         "distance": 0.494843,\n//         "id": 445297206350523266,\n//         "title": "How bad will the Coronavirus Outbreak get? \\u2014 Predicting the outbreak figures",\n//         "claps": 1100\n//     },\n//     {\n//         "reading_time": 7,\n//         "distance": 0.50522643,\n//         "id": 445297206350523757,\n//         "title": "What Does Coronavirus Mean For Your Startup?",\n//         "claps": 111\n//     },\n//     {\n//         "reading_time": 4,\n//         "distance": 0.50953895,\n//         "id": 445297206350524005,\n//         "title": "The Definitive Guide to Leading Remote Work Teams During Coronavirus",\n//         "claps": 753\n//     },\n//     {\n//         "reading_time": 6,\n//         "distance": 0.53836524,\n//         "id": 445297206350523435,\n//         "title": "The Relocation Problem of Field-Calibrated Low-Cost Air Quality Monitoring Systems",\n//         "claps": 51\n//     },\n//     {\n//         "reading_time": 7,\n//         "distance": 0.57358503,\n//         "id": 445297206350523356,\n//         "title": "The Funeral Industry is a Killer",\n//         "claps": 407\n//     }\n// ]]\n\n'))),(0,i.kt)(o.Z,{value:"go",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'// 8. Search\nfmt.Println("Start searching ...")\n\n// Output: \n//\n// Start searching ...\n\nvectors := []entity.Vector{}\n\nfor _, row := range data.Rows[:1] {\n    vector := make(entity.FloatVector, 0, 768)\n    vector = append(vector, row.TitleVector...)\n    vectors = append(vectors, vector)\n}\n\nsp, _ := entity.NewIndexAUTOINDEXSearchParam(1)\n\nlimit := client.WithLimit(10)\noffset := client.WithOffset(0)\ntopK := 5\noutputFields := []string{"id", "title", "claps", "reading_time"}\n\nres, err := conn.Search(\n    context.Background(),               // context\n    COLLNAME,                           // collectionName\n    []string{},                         // partitionNames\n    "claps > 30 and reading_time < 10", // expr\n    outputFields,                       // outputFields\n    vectors,                            // vectors\n    "title_vector",                     // vectorField\n    entity.MetricType("L2"),            // metricType\n    topK,                               // topK\n    sp,                                 // sp\n    limit,                              // opts\n    offset,                             // opts\n)\n\nif err != nil {\n    log.Fatal("Failed to insert rows:", err.Error())\n}\n\nfmt.Println(resultsToJSON(res))\n\n// Output: \n// [\n//  {\n//      "counts": 5,\n//      "distances": [\n//          0.36103836,\n//          0.37674016,\n//          0.41629803,\n//          0.4360938,\n//          0.48886314\n//      ],\n//      "rows": [\n//          {\n//              "claps": 83,\n//              "id": 5607,\n//              "reading_time": 8,\n//              "title": "The Hidden Side Effect of the Coronavirus"\n//          },\n//          {\n//              "claps": 2900,\n//              "id": 5641,\n//              "reading_time": 9,\n//              "title": "Why The Coronavirus Mortality Rate is Misleading"\n//          },\n//          {\n//              "claps": 51,\n//              "id": 3441,\n//              "reading_time": 4,\n//              "title": "Coronavirus shows what ethical Amazon could look like"\n//          },\n//          {\n//              "claps": 65,\n//              "id": 938,\n//              "reading_time": 6,\n//              "title": "Mortality Rate As an Indicator of an Epidemic Outbreak"\n//          },\n//          {\n//              "claps": 255,\n//              "id": 4275,\n//              "reading_time": 9,\n//              "title": "How Can AI Help Fight Coronavirus?"\n//          }\n//      ]\n//  }\n// ]\n')))),(0,i.kt)("p",null,"\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"claps")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"reading_time")," \u6ca1\u6709\u9884\u5148\u5b9a\u4e49\u5728 Schema \u4e2d\uff0c\u4f46\u8fd9\u4e5f\u5e76\u4e0d\u5f71\u54cd\u5728\u8868\u8fbe\u5f0f\u548c\u8f93\u51fa\u5b57\u6bb5\u4e2d\u4f7f\u7528\u5b83\u4eec\u3002"),(0,i.kt)("p",null,"\u5982\u679c\u52a8\u6001\u5b57\u6bb5\u5305\u542b\u4e86\u9664\u6570\u5b57\u3001\u5b57\u6bcd\u53ca\u4e0b\u5212\u7ebf\u4e4b\u5916\u7684\u5176\u5b83\u7279\u6b8a\u5b57\u7b26\uff08\u5982\u52a0\u53f7\u3001\u661f\u53f7\u6216\u7f8e\u5143\u7b26\u53f7\uff09\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"$meta[]"),"\u5173\u952e\u5b57\u5728\u8868\u8fbe\u5f0f\u6216\u8f93\u51fa\u5b57\u6bb5\u4e2d\u5f15\u5165\u8fd9\u4e9b\u5b57\u6bb5\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'... \nexpr=\'$meta["#key"] in ["a", "b", "c"]\', \noutput_fields=\'$meta["#key"]\'  \n...\n')),(0,i.kt)("h2",{id:"related-topics"},"\u76f8\u5173\u6587\u6863"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"./create-collection"},"\u521b\u5efa Collection")," ")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"./use-partition-key"},"\u4f7f\u7528 Partition Key")," ")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"./javascript-object-notation-json"},"\u4f7f\u7528 JSON \u7c7b\u578b\u5b57\u6bb5")))))}h.isMDXComponent=!0}}]);