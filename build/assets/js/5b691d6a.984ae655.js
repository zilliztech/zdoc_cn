"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[166],{111:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>y,frontMatter:()=>r,metadata:()=>c,toc:()=>p});var a=t(7462),i=(t(7294),t(3905)),l=(t(3612),t(4866)),o=t(5162);const r={slug:"/docs/use-partition-key",beta:!1,notebook:"03_use_partition_key.ipynb",sidebar_position:2},s="\u4f7f\u7528 Partition Key",c={unversionedId:"tutorials/collection/advanced-features/use-partition-key",id:"tutorials/collection/advanced-features/use-partition-key",title:"\u4f7f\u7528 Partition Key",description:"\u672c\u8282\u5c06\u5e2e\u52a9\u60a8\u4e86\u89e3\u5982\u4f55\u4f7f\u7528 Partition Key \u52a0\u901f\u5728 Collection \u4e2d\u7684\u6570\u636e\u68c0\u7d22\u3002",source:"@site/docs/tutorials/collection/advanced-features/use-partition-key.md",sourceDirName:"tutorials/collection/advanced-features",slug:"/docs/use-partition-key",permalink:"/docs/use-partition-key",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{slug:"/docs/use-partition-key",beta:!1,notebook:"03_use_partition_key.ipynb",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"\u5f00\u542f\u52a8\u6001 Schema",permalink:"/docs/enable-dynamic-schema"},next:{title:"\u4f7f\u7528 JSON \u7c7b\u578b\u5b57\u6bb5",permalink:"/docs/javascript-object-notation-json"}},d={},p=[{value:"\u51c6\u5907\u5de5\u4f5c",id:"before-you-start",level:2},{value:"\u521b\u5efa\u542f\u7528 Partition Key \u7684 Collection",id:"create-collection-with-partition-key-enabled",level:2},{value:"\u57fa\u4e8e Partition Key \u7684 ANN \u641c\u7d22",id:"conduct-ann-search-using-partition-key",level:2},{value:"\u5178\u578b\u4f7f\u7528\u573a\u666f",id:"typical-use-cases",level:2},{value:"\u76f8\u5173\u6587\u6863",id:"related-topics",level:2}],u={toc:p},m="wrapper";function y(e){let{components:n,...t}=e;return(0,i.kt)(m,(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u4f7f\u7528-partition-key"},"\u4f7f\u7528 Partition Key"),(0,i.kt)("p",null,"\u672c\u8282\u5c06\u5e2e\u52a9\u60a8\u4e86\u89e3\u5982\u4f55\u4f7f\u7528 Partition Key \u52a0\u901f\u5728 Collection \u4e2d\u7684\u6570\u636e\u68c0\u7d22\u3002"),(0,i.kt)("p",null,"Partition Key \u5141\u8bb8 Zilliz Cloud \u6839\u636e\u6570\u636e\u7684\u6307\u5b9a\u952e\u503c\u5c06\u6570\u636e\u5b58\u5165\u4e0d\u540c\u7684 Partition \u4e2d\u3002\u8fd9\u6837\u60a8\u5c31\u53ef\u4ee5\u6839\u636e\u6307\u5b9a\u952e\u503c\u4e3a\u6570\u636e\u5206\u7ec4\uff0c\u4ece\u800c\u5728\u6839\u636e\u952e\u503c\u8fc7\u6ee4\u65f6\u907f\u514d\u626b\u63cf\u5b8c\u5168\u65e0\u5173\u7684 Partition\u3002\u76f8\u6bd4\u4f20\u7edf\u7684\u8fc7\u6ee4\u67e5\u8be2\u65b9\u5f0f\uff0c\u542f\u7528\u8be5\u7279\u6027\u540e\u53ef\u4ee5\u6781\u5927\u5730\u63d0\u5347\u67e5\u8be2\u6027\u80fd\u3002"),(0,i.kt)("h2",{id:"before-you-start"},"\u51c6\u5907\u5de5\u4f5c"),(0,i.kt)("p",null,"\u5728\u521b\u5efa Collection \u4e4b\u524d\uff0c\u786e\u4fdd"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5df2\u7ecf\u6839\u636e\u60a8\u7684\u6570\u636e\u5b8c\u6210\u4e86 Schema \u7684\u8bbe\u8ba1\u3002\u5982\u9700\u4e86\u89e3\u66f4\u591a\uff0c\u53ef\u9605\u8bfb",(0,i.kt)("a",{parentName:"p",href:"./data-models-explained"},"\u6570\u636e\u6a21\u578b"),"\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5df2\u7ecf\u521b\u5efa\u4e86\u4e00\u4e2a\u96c6\u7fa4\u3002\u5982\u9700\u4e86\u89e3\u66f4\u591a\uff0c\u53ef\u9605\u8bfb",(0,i.kt)("a",{parentName:"p",href:"./create-cluster"},"\u521b\u5efa\u96c6\u7fa4"),"\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5df2\u4e0b\u8f7d\u793a\u4f8b\u6570\u636e\u96c6\u3002\u8be6\u60c5\u8bf7\u53c2\u89c1",(0,i.kt)("a",{parentName:"p",href:"./example-dataset"},"\u793a\u4f8b\u6570\u636e\u96c6"),"\u3002"))),(0,i.kt)("h2",{id:"create-collection-with-partition-key-enabled"},"\u521b\u5efa\u542f\u7528 Partition Key \u7684 Collection"),(0,i.kt)("p",null,"\u4e3a\u4e86\u6f14\u793a Partition Key \u7684\u4f7f\u7528\uff0c\u6211\u4eec\u5c06\u7ee7\u7eed\u4f7f\u7528\u5305\u542b\u4e86 5,000 \u7bc7\u6587\u7ae0\u7684\u793a\u4f8b\u6570\u636e\u96c6\u3002\u5176\u4e2d\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"publication")," \u5c06\u4f5c\u4e3a Partition Key\u3002"),(0,i.kt)("p",null,"\u793a\u4f8b\u4ee3\u7801\u4e2d\u5c06\u521b\u5efa\u7684 Collection \u7684 Schema \u4e0e",(0,i.kt)("a",{parentName:"p",href:"./example-dataset"},"\u793a\u4f8b\u6570\u636e\u96c6"),"\u4e2d\u5b9a\u4e49\u7684\u7c7b\u4f3c\u3002\u5dee\u5f02\u5c31\u5728\u4f5c\u4e3a Partition Key \u4f7f\u7528\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"publication")," \u5b57\u6bb5\u3002"),(0,i.kt)(l.Z,{groupId:"code",defaultValue:"python",values:[{label:"Python",value:"python"},{label:"NodeJS",value:"javascript"},{label:"Java",value:"java"},{label:"Go",value:"go"}],mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'import json, time\nfrom pymilvus import connections, FieldSchema, CollectionSchema, DataType, Collection, utility\n\nCLUSTER_ENDPOINT="YOUR_CLUSTER_ENDPOINT" # Set your cluster endpoint\nTOKEN="YOUR_CLUSTER_TOKEN" # Set your token\nCOLLECTION_NAME="medium_articles_2020" # Set your collection name\nDATASET_PATH="{}/../medium_articles_2020_dpr.json".format(os.path.dirname(__file__)) # Set your dataset path\n\nconnections.connect(\n  alias=\'default\', \n  #  Public endpoint obtained from Zilliz Cloud\n  uri=CLUSTER_ENDPOINT,\n  # API key or a colon-separated cluster username and password\n  token=TOKEN, \n)\n\n# 1. Define fields\nfields = [\n    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True),\n    FieldSchema(name="title", dtype=DataType.VARCHAR, max_length=512),   \n    FieldSchema(name="title_vector", dtype=DataType.FLOAT_VECTOR, dim=768),\n    FieldSchema(name="link", dtype=DataType.VARCHAR, max_length=512),\n    FieldSchema(name="reading_time", dtype=DataType.INT64),\n    # The field "publication" acts as the partition key.\n    FieldSchema(name="publication", dtype=DataType.VARCHAR, max_length=512, is_partition_key=True),\n    FieldSchema(name="claps", dtype=DataType.INT64),\n    FieldSchema(name="responses", dtype=DataType.INT64)\n]\n'))),(0,i.kt)(o.Z,{value:"javascript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const fs = require("fs")\nconst { MilvusClient, DataType, sleep } = require("@zilliz/milvus2-sdk-node")\n\nconst address = "YOUR_CLUSTER_ENDPOINT"\nconst token = "YOUR_CLUSTER_TOKEN"\nconst collectionName = "medium_articles_2020"\nconst data_file = `./medium_articles_2020_dpr.json`\n\nasync function main() {\n    // Connect to the cluster\n    const client = new MilvusClient({address, token})\n    \n    // 2. Define fields\n    fields = [\n        {\n            name: "id",\n            data_type: DataType.Int64,\n            is_primary_key: true,\n            auto_id: true\n        },\n        {\n            name: "title",\n            data_type: DataType.VarChar,\n            max_length: 512\n        },\n        {\n            name: "title_vector",\n            data_type: DataType.FloatVector,\n            dim: 768\n        },\n        {\n            name: "link",\n            data_type: DataType.VarChar,\n            max_length: 512\n        },\n        {\n            name: "reading_time",\n            data_type: DataType.Int64\n        },\n        {\n            name: "publication",\n            data_type: DataType.VarChar,\n            max_length: 512,\n            // The field "publication" acts as the primary key\n            is_partition_key: true\n        },\n        {\n            name: "claps",\n            data_type: DataType.Int64\n        },\n        {\n            name: "responses",\n            data_type: DataType.Int64\n        }\n    ]\n'))),(0,i.kt)(o.Z,{value:"java",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'// You should include the following in the main function\n\nString clusterEndpoint = "YOUR_CLUSTER_ENDPOINT";\nString token = "YOUR_CLUSTER_TOKEN";\nString collectionName = "medium_articles";\nString data_file = System.getProperty("user.dir") + "/medium_articles_2020_dpr.json";\n\n// 1. Connect to Zilliz Cloud cluster\nConnectParam connectParam = ConnectParam.newBuilder()\n    .withUri(clusterEndpoint)\n    .withToken(token)\n    .build();\n\nMilvusServiceClient client = new MilvusServiceClient(connectParam);\n\nSystem.out.println("Connected to Zilliz Cloud!");\n\n// Output:\n// Connected to Zilliz Cloud!\n\n// 2. Define fields\n\nFieldType id = FieldType.newBuilder()\n    .withName("id")\n    .withDataType(DataType.Int64)\n    .withPrimaryKey(true)\n    .withAutoID(true)\n    .build();\n\nFieldType title = FieldType.newBuilder()\n    .withName("title")\n    .withDataType(DataType.VarChar)\n    .withMaxLength(512)\n    .build();\n\nFieldType title_vector = FieldType.newBuilder()\n    .withName("title_vector")\n    .withDataType(DataType.FloatVector)\n    .withDimension(768)\n    .build();\n\nFieldType link = FieldType.newBuilder()\n    .withName("link")\n    .withDataType(DataType.VarChar)\n    .withMaxLength(512)\n    .build();\n\nFieldType reading_time = FieldType.newBuilder()\n    .withName("reading_time")\n    .withDataType(DataType.Int64)\n    .build();\n\nFieldType publication = FieldType.newBuilder()\n    .withName("publication")\n    .withDataType(DataType.VarChar)\n    .withMaxLength(512)\n    // This field is set as the partition key.\n    .withPartitionKey(true)\n    .build();\n\nFieldType claps = FieldType.newBuilder()\n    .withName("claps")\n    .withDataType(DataType.Int64)\n    .build();\n\nFieldType responses = FieldType.newBuilder()\n    .withName("responses")\n    .withDataType(DataType.Int64)\n    .build();\n'))),(0,i.kt)(o.Z,{value:"go",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'// You should include the following in the main function\n\nCLUSTER_ENDPOINT := "YOUR_CLUSTER_ENDPOINT"\nTOKEN := "YOUR_CLUSTER_TOKEN"\nCOLLNAME := "medium_articles_2020"\nDATA_FILE := "../../medium_articles_2020_dpr.json"\n\n// 1. Connect to cluster\nconnParams := client.Config{\n    Address: CLUSTER_ENDPOINT,\n    APIKey:  TOKEN,\n}\n\nconn, err := client.NewClient(context.Background(), connParams)\n\nif err != nil {\n    log.Fatal("Failed to connect to Zilliz Cloud:", err.Error())\n}\n\n// 2. Create collection\n\n// Define fields\nid := entity.NewField().\n    WithName("id").\n    WithDataType(entity.FieldTypeInt64).\n    WithIsPrimaryKey(true)\n\ntitle := entity.NewField().\n    WithName("title").\n    WithDataType(entity.FieldTypeVarChar).\n    WithMaxLength(512)\n\ntitle_vector := entity.NewField().\n    WithName("title_vector").\n    WithDataType(entity.FieldTypeFloatVector).\n    WithDim(768)\n\nlink := entity.NewField().\n    WithName("link").\n    WithDataType(entity.FieldTypeVarChar).\n    WithMaxLength(512)\n\nreading_time := entity.NewField().\n    WithName("reading_time").\n    WithDataType(entity.FieldTypeInt64)\n\n// The following field is set as the partition key.\npublication := entity.NewField().\n    WithName("publication").\n    WithDataType(entity.FieldTypeVarChar).\n    WithMaxLength(512).\n    WithIsPartitionKey(true)\n\nclaps := entity.NewField().\n    WithName("claps").\n    WithDataType(entity.FieldTypeInt64)\n\nresponses := entity.NewField().\n    WithName("responses").\n    WithDataType(entity.FieldTypeInt64)\n')))),(0,i.kt)("p",null,"\u5728\u5b8c\u6210\u5b57\u6bb5\u5b9a\u4e49\u4e4b\u540e\uff0c\u521b\u5efa Collection \u7684 Schema\u3002"),(0,i.kt)(l.Z,{groupId:"code",defaultValue:"python",values:[{label:"Python",value:"python"},{label:"NodeJS",value:"javascript"},{label:"Java",value:"java"},{label:"Go",value:"go"}],mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# 2. Build the schema\nschema = CollectionSchema(\n    fields,\n    description="Schema of Medium articles",\n    # As an alternative, you can set the partition key by its name in the collection schema\n    # partition_key_field="publication"\n)\n'))),(0,i.kt)(o.Z,{value:"javascript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'// 3. Build the requst for creating a collection\n\n// You should include the following in the async function declaration.\n\nconst collection_name = "medium_articles";\n\nconst req = {\n    collection_name: collectionName,\n    fields: fields,\n}\n'))),(0,i.kt)(o.Z,{value:"java",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"// 3. Build the schema\n\n// You should include the following in the main function\n\nCreateCollectionParam createCollectionParam = CreateCollectionParam.newBuilder()\n    .withCollectionName(collectionName)\n    .addFieldType(id)\n    .addFieldType(title)\n    .addFieldType(title_vector)\n    .addFieldType(link)\n    .addFieldType(reading_time)\n    .addFieldType(publication)\n    .addFieldType(claps)\n    .addFieldType(responses)\n    .build();\n"))),(0,i.kt)(o.Z,{value:"go",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"// Define schema\nschema := &entity.Schema{\n    CollectionName: COLLNAME,\n    AutoID:         true,\n    Fields: []*entity.Field{\n        id,\n        title,\n        title_vector,\n        link,\n        reading_time,\n        publication,\n        claps,\n        responses,\n    },\n}\n")))),(0,i.kt)("p",null,"\u6700\u540e\uff0c\u4f7f\u7528\u4e0a\u8ff0 Schema \u521b\u5efa Collection\u3002"),(0,i.kt)(l.Z,{groupId:"code",defaultValue:"python",values:[{label:"Python",value:"python"},{label:"NodeJS",value:"javascript"},{label:"Java",value:"java"},{label:"Go",value:"go"}],mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# 3. Create collection\ncollection = Collection(\n    name=COLLECTION_NAME, \n    description="Medium articles published between Jan and August in 2020 in prominent publications",\n    schema=schema\n)\n\nprint("Collection created successfully")\n\n# Output\n#\n# Collection created successfully\n\n# 4. Index collection\n# \'index_type\' defines the index algorithm to be used.\n#    AUTOINDEX is the only option.\n#\n# \'metric_type\' defines the way to measure the distance \n#    between vectors. Possible values are L2, IP, and Cosine,\n#    and defaults to Cosine.\nindex_params = {\n    "index_type": "AUTOINDEX",\n    "metric_type": "L2",\n    "params": {}\n}\n\n# To name the index, do as follows:\ncollection.create_index(\n  field_name="title_vector", \n  index_params=index_params,\n  index_name=\'title_vector_index\'\n)\n\n# 5. Load collection\ncollection.load()\n\n# Get loading progress\nprogress = utility.loading_progress(COLLECTION_NAME)\n\nprint(progress)\n\n# Output\n#\n# {\n#     "loading_progress": "100%"\n# }\n'))),(0,i.kt)(o.Z,{value:"javascript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"// 3. Create collection\n\nres = await client.createCollection({\n    collection_name: collectionName,\n    fields: fields,\n    // As an alternative, you can set the partition key by its name when creating a collection.\n    // partition_key_field: \"publication\"\n})\n\nconsole.log(res)\n\n// Output\n// \n// { error_code: 'Success', reason: '', code: 0 }\n// \n\n// 4. Create index\nres = await client.createIndex({\n    collection_name: collectionName,\n    field_name: \"title_vector\",\n    index_type: \"IVF_FLAT\",\n    metric_type: \"L2\",\n    params: {\n        nlist: 16384\n    }\n})\n\nconsole.log(res)\n\n// Output\n// \n// { error_code: 'Success', reason: '', code: 0 }\n// \n\nres = await client.loadCollection({\n    collection_name: collectionName\n})\n\nconsole.log(res)  \n\n// Output\n// \n// { error_code: 'Success', reason: '', code: 0 }\n// \n"))),(0,i.kt)(o.Z,{value:"java",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'// 3. Create collection\nR<RpcStatus> collection = client.createCollection(createCollectionParam);\n\nif (collection.getException() != null) {\n    System.err.println("Failed to create collection: " + collection.getException().getMessage());\n    return;\n}\n\nSystem.out.println("Collection created!");\n\n// Output:\n// Collection created!\n\n// 4. Create index\nCreateIndexParam createIndexParam = CreateIndexParam.newBuilder()\n    .withCollectionName(collectionName)\n    .withFieldName("title_vector")\n    .withIndexName("title_vector_index")\n    .withIndexType(IndexType.AUTOINDEX)\n    .withMetricType(MetricType.L2)\n    .build();\n\nR<RpcStatus> res = client.createIndex(createIndexParam);\n\nif (res.getException() != null) {\nSystem.err.println("Failed to create index: " + res.getException().getMessage());\nreturn;\n}\n\nSystem.out.println("Index created!");\n\n// Output:\n// Index created!\n'))),(0,i.kt)(o.Z,{value:"go",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'// Create collection\n\nerr = conn.CreateCollection(context.Background(), schema, 2)\n\nif err != nil {\n    log.Fatal("Failed to create collection:", err.Error())\n}\n\n// Create index for cluster\nindex, err := entity.NewIndexAUTOINDEX(entity.MetricType("L2"))\n\nif err != nil {\n    log.Fatal("Failed to prepare the index:", err.Error())\n}\n\nfmt.Println(index.Name())\n\n// Output: \n//\n// AUTOINDEX\n\nerr = conn.CreateIndex(context.Background(), COLLNAME, "title_vector", index, false)\n\nif err != nil {\n    log.Fatal("Failed to create the index:", err.Error())\n}\n\n// Load collection\nloadCollErr := conn.LoadCollection(context.Background(), COLLNAME, false)\n\nif loadCollErr != nil {\n    log.Fatal("Failed to load collection:", loadCollErr.Error())\n}\n\n// Get load progress\nprogress, err := conn.GetLoadingProgress(context.Background(), COLLNAME, nil)\n\nif err != nil {\n    log.Fatal("Failed to get loading progress:", err.Error())\n}\n\nfmt.Println("Loading progress:", progress)\n\n// Output: \n//\n// Loading progress: 100\n')))),(0,i.kt)("h2",{id:"conduct-ann-search-using-partition-key"},"\u57fa\u4e8e Partition Key \u7684 ANN \u641c\u7d22"),(0,i.kt)("p",null,"\u5728\u4e3a\u521b\u5efa\u7684 Collection \u5efa\u7acb\u7d22\u5f15\uff0c\u52a0\u8f7d\u7d22\u5f15\u6587\u4ef6\u81f3\u5185\u5b58\u5e76\u5c06\u793a\u4f8b\u6570\u636e\u96c6\u4e2d\u7684\u6570\u636e\u63d2\u5165 Collection \u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u57fa\u4e8e Partition Key \u7684\u8fd1\u4f3c\u6700\u8fd1\u90bb\uff08ANN\uff09\u641c\u7d22\u4e86\u3002\u76f8\u5173\u64cd\u4f5c\uff0c\u53ef\u53c2\u8003",(0,i.kt)("a",{parentName:"p",href:"./search-query-and-get"},"\u5411\u91cf\u641c\u7d22\u548c\u67e5\u8be2"),"\u4e2d\u7684\u5177\u4f53\u5185\u5bb9\u3002"),(0,i.kt)("p",null,"\u5728\u521b\u5efa\u641c\u7d22\u8bf7\u6c42\u65f6\uff0c\u987b\u5728\u8bf7\u6c42\u4e2d\u5305\u542b\u5982\u4e0b\u8fc7\u6ee4\u8868\u8fbe\u5f0f\uff0c\u5e76\u5c06",(0,i.kt)("inlineCode",{parentName:"p"},"<partition_key>"),"\u66ff\u6362\u4e3a\u5b9e\u9645\u62c5\u4efb Partition Key \u7684\u5b57\u6bb5\u540d\u79f0\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"expr='<partition_key>==\"xxx\"'"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},'expr=\'<partition_key> in ["xxx", "xxx"]\'')))),(0,i.kt)(l.Z,{groupId:"code",defaultValue:"python",values:[{label:"Python",value:"python"},{label:"NodeJS",value:"javascript"},{label:"Java",value:"java"},{label:"Go",value:"go"}],mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"python",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# 8. Search data\n# Metric type should be the same as\n# that defined in the index parameters \n# used to create the index.\nsearch_params = {\n    "metric_type": "L2"\n}\n\nresults = collection.search(\n    data=[rows[0][\'title_vector\']],\n    anns_field="title_vector",\n    param=search_params,\n    # When conducting searches and queries, include the partition key in the bolean expression\n    expr="claps > 30 and reading_time < 10 and publication in [\'Towards Data Science\', \'Personal Growth\']",\n    output_fields=["title", "link"],\n    limit=5\n)\n\n# Get all returned IDs\n# results[0] indicates the result \n# of the first query vector in the \'data\' list\nids = results[0].ids\n\nprint(ids)\n\n# Output\n#\n# [5641, 938, 842, 70, 3954]\n\n# Get the distance from \n# all returned vectors to the query vector.\ndistances = results[0].distances\n\nprint(distances)\n\n# Output\n#\n# [0.37674015760421753, 0.436093807220459, 0.49443870782852173, 0.4948430061340332, 0.5028785467147827]\n\n# Get the values of the output fields\n# specified in the search request\nentities = [ x.entity.to_dict()["entity"] for x in results[0]]\n\nprint(entities)\n\n# Output\n#\n# [\n#     {\n#         "title": "Why The Coronavirus Mortality Rate is Misleading",\n#         "link": "https://towardsdatascience.com/why-the-coronavirus-mortality-rate-is-misleading-cc63f571b6a6"\n#     },\n#     {\n#         "title": "Mortality Rate As an Indicator of an Epidemic Outbreak",\n#         "link": "https://towardsdatascience.com/mortality-rate-as-an-indicator-of-an-epidemic-outbreak-704592f3bb39"\n#     },\n#     {\n#         "title": "Choosing the right performance metrics can save lives against Coronavirus",\n#         "link": "https://towardsdatascience.com/choosing-the-right-performance-metrics-can-save-lives-against-coronavirus-2f27492f6638"\n#     },\n#     {\n#         "title": "How bad will the Coronavirus Outbreak get? \\u2014 Predicting the outbreak figures",\n#         "link": "https://towardsdatascience.com/how-bad-will-the-coronavirus-outbreak-get-predicting-the-outbreak-figures-f0b8e8b61991"\n#     },\n#     {\n#         "title": "How similar is COVID-19 to previously discovered Coronaviruses",\n#         "link": "https://towardsdatascience.com/how-similar-is-covid-19-to-previously-discovered-coronaviruses-c3d9f25840f7"\n#     }\n# ]\n'))),(0,i.kt)(o.Z,{value:"javascript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"// 6. Conduct an ANN search\n\nres = await client.search({\n    collection_name: collectionName,\n    vector: rows[0].title_vector,\n    limit: 3,\n    filter: \"claps > 30 and reading_time < 10 and publication in ['Towards Data Science', 'Personal Growth']\",\n    output_fields: [\"title\", \"link\"]\n});\n\nconsole.log(res);\n\n// Output\n// \n// {\n//   status: { error_code: 'Success', reason: '', code: 0 },\n//   results: [\n//     {\n//       score: 0.37674015760421753,\n//       id: '5641',\n//       title: 'Why The Coronavirus Mortality Rate is Misleading',\n//       link: 'https://towardsdatascience.com/why-the-coronavirus-mortality-rate-is-misleading-cc63f571b6a6'\n//     },\n//     {\n//       score: 0.436093807220459,\n//       id: '938',\n//       title: 'Mortality Rate As an Indicator of an Epidemic Outbreak',\n//       link: 'https://towardsdatascience.com/mortality-rate-as-an-indicator-of-an-epidemic-outbreak-704592f3bb39'\n//     },\n//     {\n//       score: 0.49443864822387695,\n//       id: '842',\n//       title: 'Choosing the right performance metrics can save lives against Coronavirus',\n//       link: 'https://towardsdatascience.com/choosing-the-right-performance-metrics-can-save-lives-against-coronavirus-2f27492f6638'\n//     }\n//   ]\n// }\n// \n\n// 7. Get collection info\n\nres = await client.describeCollection({\n    collection_name: collectionName\n})\n\nconsole.log(res);\n\n// Output\n// \n// {\n//   virtual_channel_names: [ 'by-dev-rootcoord-dml_11_445311585782775508v0' ],\n//   physical_channel_names: [ 'by-dev-rootcoord-dml_11' ],\n//   aliases: [],\n//   start_positions: [],\n//   properties: [],\n//   status: { error_code: 'Success', reason: '', code: 0 },\n//   schema: {\n//     fields: [\n//       [Object], [Object],\n//       [Object], [Object],\n//       [Object], [Object],\n//       [Object], [Object]\n//     ],\n//     name: 'medium_articles_2020',\n//     description: '',\n//     autoID: false,\n//     enable_dynamic_field: false\n//   },\n//   collectionID: '445311585782775508',\n//   created_timestamp: '445316810423664644',\n//   created_utc_timestamp: '1698748819060',\n//   shards_num: 1,\n//   consistency_level: 'Bounded',\n//   collection_name: 'medium_articles_2020',\n//   db_name: 'default',\n//   num_partitions: '64'\n// }\n// \n"))),(0,i.kt)(o.Z,{value:"java",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'// 7. Search vectors\n\nList<List<Float>> queryVectors = new ArrayList<>();\nList<Float> queryVector1 = rows.get(0).getJSONArray("title_vector").toJavaList(Float.class);\nqueryVectors.add(queryVector1);\n\nList<String> outputFields = new ArrayList<>();\noutputFields.add("title");\noutputFields.add("link");\n\n// Search vectors in a collection\n\nSearchParam searchParam = SearchParam.newBuilder()\n    .withCollectionName(collectionName)\n    .withVectorFieldName("title_vector")\n    .withVectors(queryVectors)\n    .withTopK(5)   \n    .withMetricType(MetricType.L2)  \n    .withParams("{\\"nprobe\\":10,\\"offset\\":2, \\"limit\\":3}")\n    .withConsistencyLevel(ConsistencyLevelEnum.BOUNDED)\n    .withOutFields(outputFields)\n    .withExpr("(publication == \\"Towards Data Science\\") and ((claps > 1500 and responses > 15) or (10 < reading_time < 15))")\n    .build();\n\nR<SearchResults> response = client.search(searchParam);\n\nSearchResultsWrapper wrapper = new SearchResultsWrapper(response.getData().getResults());\n\nList<List<JSONObject>> results = new ArrayList<>();\n\nfor (int i = 0; i < queryVectors.size(); ++i) {\n    List<SearchResultsWrapper.IDScore> scores = wrapper.getIDScore(i);\n    List<JSONObject> entities = new ArrayList<>();\n    for (int j = 0; j < scores.size(); ++j) {\n        SearchResultsWrapper.IDScore score = scores.get(j);\n        JSONObject entity = new JSONObject(1, true);\n        entity.put("id", score.getLongID());\n        entity.put("distance", score.getScore());\n        entity.put("title", scores.get(j).get("title"));\n        entity.put("link", scores.get(j).get("link"));\n        entities.add(entity);\n    }\n    \n    results.add(entities);\n} \n\nSystem.out.println(results);\n\n// Output:\n// [[\n//     {\n//         "distance": 0.85477614,\n//         "link": "https://towardsdatascience.com/finding-optimal-nba-physiques-using-data-visualization-with-python-6ce27ac5b68f",\n//         "id": 445297206350548235,\n//         "title": "Finding optimal NBA physiques using data visualization with Python"\n//     },\n//     {\n//         "distance": 0.8702322,\n//         "link": "https://towardsdatascience.com/understanding-nlp-how-ai-understands-our-languages-77601002cffc",\n//         "id": 445297206350548216,\n//         "title": "Understanding Natural Language Processing: how AI understands our languages"\n//     },\n//     {\n//         "distance": 0.9109591,\n//         "link": "https://towardsdatascience.com/rage-quitting-cancer-research-5e79cb04801",\n//         "id": 445297206350548215,\n//         "title": "Rage Quitting Cancer Research"\n//     },\n//     {\n//         "distance": 0.9840777,\n//         "link": "https://towardsdatascience.com/data-cleaning-in-python-the-ultimate-guide-2020-c63b88bf0a0d",\n//         "id": 445297206350548209,\n//         "title": "Data Cleaning in Python: the Ultimate Guide (2020)"\n//     },\n//     {\n//         "distance": 1.091625,\n//         "link": "https://towardsdatascience.com/top-10-in-demand-programming-languages-to-learn-in-2020-4462eb7d8d3e",\n//         "id": 445297206350548205,\n//         "title": "Top 10 In-Demand programming languages to learn in 2020"\n//     }\n// ]]\n'))),(0,i.kt)(o.Z,{value:"go",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'// Search\n\nfmt.Println("Start searching ...")\n\n// Output: \n//\n// Start searching ...\n\nvectors := []entity.Vector{}\n\nfor _, row := range data.Rows[:1] {\n    vector := make(entity.FloatVector, 0, 768)\n    vector = append(vector, row.TitleVector...)\n    vectors = append(vectors, vector)\n}\n\nsp, _ := entity.NewIndexAUTOINDEXSearchParam(1)\n\nlimit := client.WithLimit(10)\noffset := client.WithOffset(0)\ntopK := 5\noutputFields := []string{"title", "claps", "publication", "responses", "reading_time"}\nexpr := "(publication == \\"Towards Data Science\\") and ((claps > 1500 and responses > 15) or (10 < reading_time < 15))"\n\nres, err := conn.Search(\n    context.Background(),    // context\n    COLLNAME,                // collectionName\n    []string{},              // partitionNames\n    expr,                    // expr\n    outputFields,            // outputFields\n    vectors,                 // vectors\n    "title_vector",          // vectorField\n    entity.MetricType("L2"), // metricType\n    topK,                    // topK\n    sp,                      // sp\n    limit,                   // opts\n    offset,                  // opts\n)\n\nif err != nil {\n    log.Fatal("Failed to insert rows:", err.Error())\n}\n\nfmt.Println(resultsToJSON(res))\n\n// Output: \n// [\n//  {\n//      "counts": 5,\n//      "distances": [\n//          0.37674016,\n//          0.45862228,\n//          0.5037479,\n//          0.52556163,\n//          0.58774835\n//      ],\n//      "rows": [\n//          {\n//              "claps": 2900,\n//              "publication": "Towards Data Science",\n//              "reading_time": 9,\n//              "responses": 47,\n//              "title": "Why The Coronavirus Mortality Rate is Misleading"\n//          },\n//          {\n//              "claps": 15,\n//              "publication": "Towards Data Science",\n//              "reading_time": 12,\n//              "responses": 0,\n//              "title": "Heart Disease Risk Assessment Using Machine Learning"\n//          },\n//          {\n//              "claps": 161,\n//              "publication": "Towards Data Science",\n//              "reading_time": 13,\n//              "responses": 3,\n//              "title": "New Data Shows a Lower Covid-19 Fatality Rate"\n//          },\n//          {\n//              "claps": 20,\n//              "publication": "Towards Data Science",\n//              "reading_time": 11,\n//              "responses": 1,\n//              "title": "Common Pipenv Errors"\n//          },\n//          {\n//              "claps": 61,\n//              "publication": "Towards Data Science",\n//              "reading_time": 12,\n//              "responses": 0,\n//              "title": "Data quality impact on the dataset"\n//          }\n//      ]\n//  }\n// ]\n')))),(0,i.kt)("h2",{id:"typical-use-cases"},"\u5178\u578b\u4f7f\u7528\u573a\u666f"),(0,i.kt)("p",null,"\u8be5\u7279\u6027\u53ef\u5728\u591a\u79df\u6237\u573a\u666f\u4e2d\u7528\u4e8e\u533a\u5206\u79df\u6237\u3002"),(0,i.kt)("p",null,"\u5177\u4f53\u6765\u8bf4\uff0c\u53ef\u4ee5\u5c06\u6bcf\u6761\u8bb0\u5f55\u4e2d\u7684\u67d0\u4e2a\u5b57\u6bb5\u786e\u5b9a\u4e3a Partition Key\u3002\u5f53\u8fdb\u884c\u641c\u7d22\u6216\u67e5\u8be2\u65f6\uff0c\u53ef\u4ee5\u7528\u8be5\u5b57\u6bb5\u8fc7\u6ee4\u67e5\u8be2\u7ed3\u679c\uff0c\u5b9e\u73b0\u79df\u6237\u6570\u636e\u9694\u79bb\u7684\u540c\u65f6\uff0c\u907f\u514d\u5728\u67e5\u8be2\u65f6\u626b\u63cf\u5176\u5b83\u79df\u6237\u7684 Partition\u3002"),(0,i.kt)("h2",{id:"related-topics"},"\u76f8\u5173\u6587\u6863"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"./create-collection"},"\u521b\u5efa Collection"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"./enable-dynamic-schema"},"\u5f00\u542f\u52a8\u6001 Schema"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"./javascript-object-notation-json"},"\u4f7f\u7528 JSON \u7c7b\u578b\u5b57\u6bb5")))))}y.isMDXComponent=!0}}]);