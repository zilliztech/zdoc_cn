{
  "creator": "ou_e55a208a81fc721928685fc3df9cb678",
  "has_child": false,
  "node_create_time": "1687140638",
  "node_token": "EpHowtn3miepTyk2pNlcLwDonyD",
  "node_type": "origin",
  "obj_create_time": "1687140638",
  "obj_edit_time": "1700715334",
  "obj_token": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
  "obj_type": "docx",
  "origin_node_token": "EpHowtn3miepTyk2pNlcLwDonyD",
  "origin_space_id": "7167193056431783939",
  "owner": "ou_e55a208a81fc721928685fc3df9cb678",
  "parent_node_token": "Yd32wNk7uiNEw3kd1dAcSV05nAb",
  "space_id": "7167193056431783939",
  "title": "开启动态 Schema",
  "slug": "enable-dynamic-schema",
  "blocks": {
    "items": [
      {
        "block_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "block_type": 1,
        "children": [
          "YgfedT1QvoDdsox8C43czfI4nwh",
          "CN0MdMzCnoIHQDxMuWhcs4ECnVe",
          "CF9RdfLEWorddDxIXz7cKmZonhf",
          "TeCKdEqmaoakC9xQMMzcl0YMnvc",
          "W27QdKFuqoHaqjxXagKcM2aVnUg",
          "YuYDdXSrKo1MFtxu7w2c5rckntd",
          "YagUdfmfvo16nOx7r5ScMepWnjd",
          "PgHRdeAHnoruKexlz6pcQd4snKh",
          "M4JCda8Tuoy6QYxXZd7cai6ZnXe",
          "V0khdIqVKoDWYaxYkP0cI5hwnrc",
          "PmdsdDHI0o2en3xDFcPcaalPnQP",
          "ZmcidP1DZo2qV9xO2ircdirgnNc",
          "WE6Vd68zGoqfE6xaoOwcJvvWnsd",
          "X0HKdRUE7ov0n4xLVxOcznjinMb",
          "XMl8dsXGLo5c6qxAIydchbmNnxY",
          "WqaNdhGqpoPXFWxK2HYcTnRBnxg",
          "Ba5ZdSdtHoWovKxCk1kcRmXOnZe",
          "Hz4xdXSCBoUp2sxmUCicgYCFnMc",
          "GfmBdC7EToyd6GxSUEpcmn4Vn0Z",
          "MW1cdcat6o5Zngx8NKYc9GWfnOc",
          "L44FdbWgBorpHhxh7Usc94FHnKb",
          "AR6Pd0tl9ouGjXxMuQAcoEg4nmg",
          "J9Hcd4JFxowQWTxX5ZEc8m0vn6c",
          "BIDsdC7L7o9UL2xyVQ9cNFh2ntg",
          "OqSfdW8vwoDC1wxIm2KcQnP6n4g",
          "FmCzd3Vf8oXXb8xyReIcpjcPnnf",
          "NxlldYKqqouQR9xf2Z8cjuU7nQf",
          "V0GVdLwV4o0hvXx43ZycxMjmnsh",
          "CCeSdOLrCoIQIVxcGvMcKCI3nab",
          "DerDdpWPaorhZfxXirSck60BnEd",
          "RmiIdJDgnopSXQx5KOWc7XYPnPe",
          "W2VmddAdhoI2c6xZ060clMHHnnc",
          "Lr6rduwzuo4AcmxnQc8cAwYlnhh",
          "XJ3ndyGxGoa2jPxZRvWcdQ8Yn21",
          "UtrPdN4GYoAKYJx0jEkcBREFn6f",
          "FoWQdC2j2ovyVexaOiAc9nYMnBh",
          "JxV9deFVDoQOwKx0vVucD7uankb",
          "AptBdQNV4o1CDbxnJfRczD82ndQ"
        ],
        "page": {
          "elements": [
            {
              "text_run": {
                "content": "开启动态 Schema",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1
          }
        },
        "parent_id": ""
      },
      {
        "block_id": "YgfedT1QvoDdsox8C43czfI4nwh",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "Schema 对于 Zilliz Cloud 集群的数据处理非常重要。在向 Collection 中插入 Entity 前，需要先",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "根据业务需求设计",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": " Schema，并确保所有待插入的 Entity 的结构都与",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "设计好的",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": " Schema 相匹配。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "如果业务需求发生变化，可能会导致需要重新设计 Schema。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "CN0MdMzCnoIHQDxMuWhcs4ECnVe",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "动态 Schema 的引入使得用户能够在不修改现有 Schema 的前提下，将带有新字段的 Entity 插入到 Collection。也就是说，开启动态 Schema 后，您",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "可以在不修改",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": " Schema",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": " 的情况下",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "，直接向 Collection 插入未定义的字段即可。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "CF9RdfLEWorddDxIXz7cKmZonhf",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "动态 Schema 使得数据处理更加灵活，用户能够在 Collection 中存储和检索复杂结构的数据，包括嵌套数据、数组以及其他复杂数据类型。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "TeCKdEqmaoakC9xQMMzcl0YMnvc",
        "block_type": 4,
        "heading2": {
          "elements": [
            {
              "text_run": {
                "content": "为 Collection 开启动态 Schema{#create-collection-with-dynamic-schema-enabled}",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "W27QdKFuqoHaqjxXagKcM2aVnUg",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "要为 Collection 开启动态 Schema，需要在定义 Schema 时将 ",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "enable_dynamic_field",
                "text_element_style": {
                  "bold": false,
                  "inline_code": true,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": " 设置为 ",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "True",
                "text_element_style": {
                  "bold": false,
                  "inline_code": true,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "。开启动态 Schema 后，之后插入的 Entity 中的所有未定义字段将以键值对的形式",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "存入 Collection",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "。我们将用“动态字段”来指代这些键值对。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "YuYDdXSrKo1MFtxu7w2c5rckntd",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "和预先定义的字段",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "一样",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "，",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "您可以要求 Zilliz Cloud 在搜索或查询结果中输出动态字段，也可以在布尔表达式中引用动态字段。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "YagUdfmfvo16nOx7r5ScMepWnjd",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "在执行如下代码之前，请确认已连接至您的集群。如需连接集群，可参考",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "mention_doc": {
                "obj_type": 16,
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                },
                "title": "连接集群",
                "token": "HU31wDHCCiN9qIknZ2fcLmconNh",
                "url": "https://zilliverse.feishu.cn/wiki/HU31wDHCCiN9qIknZ2fcLmconNh"
              }
            },
            {
              "text_run": {
                "content": "。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "PgHRdeAHnoruKexlz6pcQd4snKh",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "import json, os, time\nfrom pymilvus import connections, FieldSchema, CollectionSchema, DataType, Collection, utility\n\nCLUSTER_ENDPOINT=\"YOUR_CLUSTER_ENDPOINT\" # Set your cluster endpoint\nTOKEN=\"YOUR_CLUSTER_TOKEN\" # Set your token\nCOLLECTION_NAME=\"medium_articles_2020\" # Set your collection name\nDATASET_PATH=\"{}/../medium_articles_2020_dpr.json\".format(os.path.dirname(__file__)) # Set your dataset path\n\n# 1. Connect to cluster\nconnections.connect(\n  alias='default', \n  #  Public endpoint obtained from Zilliz Cloud\n  uri=CLUSTER_ENDPOINT,\n  # API key or a colon-separated cluster username and password\n  token=TOKEN, \n)\n\n# 2. Define fields\nfields = [\n    FieldSchema(name=\"id\", dtype=DataType.INT64, is_primary=True, auto_id=True, max_length=100),\n    FieldSchema(name=\"title\", dtype=DataType.VARCHAR, max_length=512),\n    FieldSchema(name=\"title_vector\", dtype=DataType.FLOAT_VECTOR, dim=768)\n]\n\n# 3. Create schema with dynamic field enabled\nschema = CollectionSchema(\n    fields,\n    \"The schema for a medium news collection\",\n    enable_dynamic_field=True\n)\n\n# 4. Create collection\ncollection = Collection(COLLECTION_NAME, schema)\n\n# 5. Index collection\nindex_params = {\n    \"index_type\": \"AUTOINDEX\",\n    \"metric_type\": \"L2\",\n    \"params\": {}\n}\n\ncollection.create_index(\n  field_name=\"title_vector\", \n  index_params=index_params\n)\n\ncollection.load()\n\n# Get loading progress\nprogress = utility.loading_progress(COLLECTION_NAME)\n\nprint(progress)\n\n# Output\n#\n# {\n#     \"loading_progress\": \"100%\"\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "# }",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 49,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "M4JCda8Tuoy6QYxXZd7cai6ZnXe",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "const fs = require(\"fs\")\nconst { MilvusClient, DataType, sleep } = require(\"@zilliz/milvus2-sdk-node\")\n\nconst address = \"YOUR_CLUSTER_ENDPOINT\"\nconst token = \"YOUR_CLUSTER_TOKEN\"\nconst collectionName = \"medium_articles_2020\"\nconst data_file = `./medium_articles_2020_dpr.json`\n\nasync function main() {\n    // 1. Connect to cluster\n    const client = new MilvusClient({address, token})\n    \n    // 2. Define fields\n    fields = [\n        {\n            name: \"id\",\n            data_type: DataType.Int64,\n            is_primary_key: true,\n            auto_id: true\n        },\n        {\n            name: \"title\",\n            data_type: DataType.VarChar,\n            max_length: 512\n        },\n        {\n            name: \"title_vector\",\n            data_type: DataType.FloatVector,\n            dim: 768\n        },\n    ]\n    \n    // 3. Create collection\n    res = await client.createCollection({\n        collection_name: collectionName,\n        fields: fields,\n        enable_dynamic_field: true\n    })\n\n    console.log(res)\n\n    // Output\n    // \n    // { error_code: 'Success', reason: '', code: 0 }\n    // \n\n    // 4. Create index\n    res = await client.createIndex({\n        collection_name: collectionName,\n        field_name: \"title_vector\",\n        index_type: \"IVF_FLAT\",\n        metric_type: \"L2\",\n        params: {\n            nlist: 1024\n        }\n    })\n\n    console.log(res)\n\n    // Output\n    // \n    // { error_code: 'Success', reason: '', code: 0 }\n    // \n\n    res = await client.loadCollection({\n        collection_name: collectionName\n    })\n\n    console.log(res)    \n\n    // Output\n    // \n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "    // { error_code: 'Success', reason: '', code: 0 }",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 30,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "V0khdIqVKoDWYaxYkP0cI5hwnrc",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "package com.zilliz.docs;\n\nimport io.milvus.client.*;\nimport io.milvus.param.*;\nimport io.milvus.param.collection.FieldType;\nimport io.milvus.param.index.CreateIndexParam;\nimport io.milvus.param.collection.CreateCollectionParam;\nimport io.milvus.param.collection.DropCollectionParam;\nimport io.milvus.grpc.DataType;\nimport io.milvus.param.dml.InsertParam;\nimport io.milvus.grpc.MutationResult;\nimport io.milvus.response.MutationResultWrapper;\nimport io.milvus.param.dml.SearchParam;\nimport io.milvus.grpc.SearchResults;\nimport io.milvus.response.SearchResultsWrapper;\nimport io.milvus.param.collection.LoadCollectionParam;\n\nimport com.alibaba.fastjson.JSON;\nimport com.alibaba.fastjson.JSONArray;\nimport com.alibaba.fastjson.JSONObject;\n\nimport java.util.List;\nimport java.util.ArrayList;\nimport java.nio.file.Files;\nimport java.nio.file.Path;\n\n/**\n * Hello world!\n */\npublic final class EnableDynamicSchemaDemo {\n    private EnableDynamicSchemaDemo() {\n    }\n\n    /**\n     * Says hello to the world.\n     * @param args The arguments of the program.\n     */\n    public static void main(String[] args) {\n        String clusterEndpoint = \"YOUR_CLUSTER_ENDPOINT\";\n        String token = \"YOUR_CLUSTER_TOKEN\";\n        String collectionName = \"medium_articles\";\n        String data_file = System.getProperty(\"user.dir\") + \"/medium_articles_2020_dpr.json\";\n\n        // 1. Connect to Zilliz Cloud cluster\n        ConnectParam connectParam = ConnectParam.newBuilder()\n            .withUri(clusterEndpoint)\n            .withToken(token)\n            .build();\n\n        MilvusServiceClient client = new MilvusServiceClient(connectParam);\n\n        System.out.println(\"Connected to Zilliz Cloud!\");\n\n        // Output:\n        // Connected to Zilliz Cloud!\n\n        // 2. Define fields\n\n        FieldType id = FieldType.newBuilder()\n            .withName(\"id\")\n            .withDataType(DataType.Int64)\n            .withPrimaryKey(true)\n            .withAutoID(true)\n            .build();\n\n        FieldType title = FieldType.newBuilder()\n            .withName(\"title\")\n            .withDataType(DataType.VarChar)\n            .withMaxLength(512)\n            .build();\n\n        FieldType title_vector = FieldType.newBuilder()\n            .withName(\"title_vector\")\n            .withDataType(DataType.FloatVector)\n            .withDimension(768)\n            .build();\n\n        // 3. Create collection\n\n        CreateCollectionParam createCollectionParam = CreateCollectionParam.newBuilder()\n            .withCollectionName(collectionName)\n            .withDescription(\"Schema of Medium articles\")\n            .addFieldType(id)\n            .addFieldType(title)\n            .addFieldType(title_vector)\n            // Enable dynamic schema\n            .withEnableDynamicField(true)\n            .build();\n\n        R<RpcStatus> collection = client.createCollection(createCollectionParam);\n\n        if (collection.getException() != null) {\n            System.err.println(\"Failed to create collection: \" + collection.getException().getMessage());\n            return;\n        }\n\n        System.out.println(\"Collection created!\");\n\n        // Output:\n        // Collection created!\n\n        // 4. Create index\n\n        CreateIndexParam createIndexParam = CreateIndexParam.newBuilder()\n            .withCollectionName(collectionName)\n            .withFieldName(\"title_vector\")\n            .withIndexName(\"title_vector_index\")\n            .withIndexType(IndexType.AUTOINDEX)\n            .withMetricType(MetricType.L2)\n            .build();\n\n        R<RpcStatus> res = client.createIndex(createIndexParam);\n\n        if (res.getException() != null) {\n            System.err.println(\"Failed to create index: \" + res.getException().getMessage());\n            return;\n        }\n\n        System.out.println(\"Index created!\");\n\n        // Output:\n        // Index created!\n\n        // 5. Load collection\n\n        LoadCollectionParam loadCollectionParam = LoadCollectionParam.newBuilder()\n            .withCollectionName(collectionName)\n            .build();\n\n        R<RpcStatus> loadCollectionRes = client.loadCollection(loadCollectionParam);\n\n        if (loadCollectionRes.getException() != null) {\n            System.err.println(\"Failed to load collection: \" + loadCollectionRes.getException().getMessage());\n            return;\n        }\n\n        System.out.println(\"Collection loaded!\");\n\n        // Output:\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "        // Collection loaded!",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 29,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "PmdsdDHI0o2en3xDFcPcaalPnQP",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "import \"github.com/milvus-io/milvus-sdk-go/v2/entity\"\n\n// You should include the following in the main function\n\n// 1. Connect to cluster\n\nconnParams := client.Config{\n    Address: CLUSTER_ENDPOINT,\n    APIKey:  TOKEN,\n}\n\nconn, err := client.NewClient(context.Background(), connParams)\n\nif err != nil {\n    log.Fatal(\"Failed to connect to Zilliz Cloud:\", err.Error())\n}\n\n// 2. Create collection\n\n// Define fields\nid := entity.NewField().\n    WithName(\"id\").\n    WithDataType(entity.FieldTypeInt64).\n    WithIsPrimaryKey(true)\n\ntitle := entity.NewField().\n    WithName(\"title\").\n    WithDataType(entity.FieldTypeVarChar).\n    WithMaxLength(512)\n\ntitle_vector := entity.NewField().\n    WithName(\"title_vector\").\n    WithDataType(entity.FieldTypeFloatVector).\n    WithDim(768)\n\n// Define schema\nschema := &entity.Schema{\n    CollectionName: COLLNAME,\n    AutoID:         true,\n    Fields: []*entity.Field{\n        id,\n        title,\n        title_vector,\n    },\n    EnableDynamicField: true,\n}\n\nerr = conn.CreateCollection(context.Background(), schema, 2)\n\nif err != nil {\n    log.Fatal(\"Failed to create collection:\", err.Error())\n}\n\n// 3. Create index for cluster\nindex, err := entity.NewIndexAUTOINDEX(entity.MetricType(\"L2\"))\n\nif err != nil {\n    log.Fatal(\"Failed to prepare the index:\", err.Error())\n}\n\nfmt.Println(index.Name())\n\n// Output: \n//\n// AUTOINDEX\n\nerr = conn.CreateIndex(context.Background(), COLLNAME, \"title_vector\", index, false)\n\nif err != nil {\n    log.Fatal(\"Failed to create the index:\", err.Error())\n}\n\n// 4. Load collection\nloadCollErr := conn.LoadCollection(context.Background(), COLLNAME, false)\n\nif loadCollErr != nil {\n    log.Fatal(\"Failed to load collection:\", loadCollErr.Error())\n}\n\n// 5. Get load progress\nprogress, err := conn.GetLoadingProgress(context.Background(), COLLNAME, nil)\n\nif err != nil {\n    log.Fatal(\"Failed to get loading progress:\", err.Error())\n}\n\nfmt.Println(\"Loading progress:\", progress)\n\n// Output: \n//\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "// Loading progress: 100",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 22,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "ZmcidP1DZo2qV9xO2ircdirgnNc",
        "block_type": 4,
        "heading2": {
          "elements": [
            {
              "text_run": {
                "content": "动态插入数据{#insert-dynamic-data}",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "WE6Vd68zGoqfE6xaoOwcJvvWnsd",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "Collection 创建完成后，可以开始动态插入数据。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "X0HKdRUE7ov0n4xLVxOcznjinMb",
        "block_type": 5,
        "heading3": {
          "elements": [
            {
              "text_run": {
                "content": "准备数据{#prepare-data}",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "XMl8dsXGLo5c6qxAIydchbmNnxY",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "现在，我们需要从",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "mention_doc": {
                "obj_type": 16,
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                },
                "title": "示例数据集",
                "token": "ZoXbwP8hJivPw2ktsLrckw0Snif",
                "url": "https://zilliverse.feishu.cn/wiki/ZoXbwP8hJivPw2ktsLrckw0Snif"
              }
            },
            {
              "text_run": {
                "content": "中读取数据。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "WqaNdhGqpoPXFWxK2HYcTnRBnxg",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "# 6. Prepare data\nwith open(DATASET_PATH) as f:\n    data = json.load(f)\n    list_of_rows = data['rows']\n\n    data_rows = []\n    for row in list_of_rows:\n        # Remove the id field because the primary key has auto_id enabled.\n        del row['id']\n        # Other keys except the title and title_vector fields in the row \n        # will be treated as dynamic fields.\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "        data_rows.append(row)",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 49,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "Ba5ZdSdtHoWovKxCk1kcRmXOnZe",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "// You should include the following in the async function declaration\n\n// 5. prepare data\nconst data = JSON.parse(fs.readFileSync(data_file, {encoding: \"utf-8\"}))\n\n// read rows\nconst rows = data[\"rows\"]\nconst row = rows[0]\n\nconsole.log(Object.keys(row))\n\n// Output\n// \n// [\n//   'id',\n//   'title',\n//   'title_vector',\n//   'link',\n//   'reading_time',\n//   'publication',\n//   'claps',\n//   'responses'\n// ]\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "// ",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 30,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "Hz4xdXSCBoUp2sxmUCicgYCFnMc",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "// You should include the following in the main function\n\n// 5. prepare data\nString content;\n\n// read a local file\nPath file = Path.of(data_file);\ntry {\n    content = Files.readString(file);\n} catch (Exception e) {\n    System.err.println(\"Failed to read file: \" + e.getMessage());\n    return;\n}\n\nSystem.out.println(\"Successfully read file\");\n\n// Output:\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "// Successfully read file",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 29,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "GfmBdC7EToyd6GxSUEpcmn4Vn0Z",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "// You should include the following in the main function\n\n// 6. Read the dataset\nfile, err := os.ReadFile(DATA_FILE)\nif err != nil {\n    log.Fatal(\"Failed to read file:\", err.Error())\n}\n\nvar data Dataset\n\nif err := json.Unmarshal(file, &data); err != nil {\n    log.Fatal(err.Error())\n}\n\nfmt.Println(\"Dataset loaded, row number: \", len(data.Rows))\n\n// Output: \n//\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "// Dataset loaded, row number:  5979",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 22,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "MW1cdcat6o5Zngx8NKYc9GWfnOc",
        "block_type": 5,
        "heading3": {
          "elements": [
            {
              "text_run": {
                "content": "插入数据{#insert-data}",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "L44FdbWgBorpHhxh7Usc94FHnKb",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "数据准备完成后便可以开始插入数据：",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "AR6Pd0tl9ouGjXxMuQAcoEg4nmg",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "# 7. Insert data\nresult = collection.insert(data_rows)\ncollection.flush()\n\nprint(f\"Data inserted successfully! Inserted counts: {result.insert_count}\")\n\n# Output\n#\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "# Data inserted successfully! Inserted counts: 5979",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 49,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "J9Hcd4JFxowQWTxX5ZEc8m0vn6c",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "// You should include the following in the async function declaration\n\n// 6. insert data\nres = await client.insert({\n    collection_name: collectionName,\n    data: rows\n})\n\nconsole.log(res)\n\n// Output\n// \n// {\n//   succ_index: [\n//      0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11,\n//     12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,\n//     24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,\n//     36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,\n//     48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59,\n//     60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71,\n//     72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83,\n//     84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95,\n//     96, 97, 98, 99,\n//     ... 5879 more items\n//   ],\n//   err_index: [],\n//   status: { error_code: 'Success', reason: '', code: 0 },\n//   IDs: { int_id: { data: [Array] }, id_field: 'int_id' },\n//   acknowledged: false,\n//   insert_cnt: '5979',\n//   delete_cnt: '0',\n//   upsert_cnt: '0',\n//   timestamp: '445316728739856387'\n// }\n// \n\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "await sleep(5000)",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 30,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "BIDsdC7L7o9UL2xyVQ9cNFh2ntg",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "// You should include the following in the main function\n\n// Load dataset\nJSONObject dataset = JSON.parseObject(content);\n\n// Insert your data in rows, all the fields not pre-defined in the schema \n// are recognized as pre-defined schema\nList<JSONObject> rows = getRows(dataset.getJSONArray(\"rows\"), 1000);\n\nInsertParam insertParam = InsertParam.newBuilder()\n    .withCollectionName(collectionName)\n    .withRows(rows)\n    .build();\n\nR<MutationResult> insertResponse = client.insert(insertParam);\n\nif (insertResponse.getStatus() != R.Status.Success.getCode()) {\n    System.err.println(insertResponse.getMessage());\n}\n\nMutationResultWrapper mutationResultWrapper = new MutationResultWrapper(insertResponse.getData());\n\nSystem.out.println(\"Successfully insert entities: \" + mutationResultWrapper.getInsertCount());  \n\n// Output:\n// Successfully insert entities: 1000\n\n// wait for a while\ntry {\n    // pause execution for 5 seconds\n    Thread.sleep(5000);\n} catch (InterruptedException e) {\n    // handle the exception\n    Thread.currentThread().interrupt();\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "} ",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 29,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "OqSfdW8vwoDC1wxIm2KcQnP6n4g",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "// You should include the following in the main function\n\n// 6. Insert data\nfmt.Println(\"Start inserting ...\")\n\n// Output: \n//\n// Start inserting ...\n\nrows := make([]interface{}, 0, 1)\n\nfor i := 0; i < len(data.Rows); i++ {\n    rows = append(rows, data.Rows[i])\n}\n\ncol, err := conn.InsertRows(context.Background(), COLLNAME, \"\", rows)\n\nif err != nil {\n    log.Fatal(\"Failed to insert rows:\", err.Error())\n}\n\nfmt.Println(\"Inserted entities: \", col.Len())\n\n// Output: \n//\n// Inserted entities:  5979\n\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "time.Sleep(5 * time.Second)",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 22,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "FmCzd3Vf8oXXb8xyReIcpjcPnnf",
        "block_type": 4,
        "heading2": {
          "elements": [
            {
              "text_run": {
                "content": "使用动态字段搜索{#search-with-dynamic-fields}",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "NxlldYKqqouQR9xf2Z8cjuU7nQf",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "假设前面的所有步骤都已完成，此时我们便可以在搜索或查询的表达式中使用动态字段：",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "V0GVdLwV4o0hvXx43ZycxMjmnsh",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "# 8. Search data\nresult = collection.search(\n    data=[data_rows[0]['title_vector']],\n    anns_field=\"title_vector\",\n    param={\"metric_type\": \"L2\", \"params\": {\"nprobe\": 10}},\n    limit=3,\n    # Access dynamic fields in the boolean expression\n    expr='claps > 30 and reading_time < 10',\n    # Include dynamic fields in the output to return\n    output_fields=[\"title\", \"reading_time\", \"claps\"],\n)\n\nresult = [ list(map(lambda y: y.entity.to_dict(), x)) for x in result ]\n\nprint(result)\n\n# Output\n#\n# [\n#     [\n#         {\n#             \"id\": 443943328732915404,\n#             \"distance\": 0.36103835701942444,\n#             \"entity\": {\n#                 \"title\": \"The Hidden Side Effect of the Coronavirus\",\n#                 \"reading_time\": 8,\n#                 \"claps\": 83\n#             }\n#         },\n#         {\n#             \"id\": 443943328732915438,\n#             \"distance\": 0.37674015760421753,\n#             \"entity\": {\n#                 \"title\": \"Why The Coronavirus Mortality Rate is Misleading\",\n#                 \"reading_time\": 9,\n#                 \"claps\": 2900\n#             }\n#         },\n#         {\n#             \"id\": 443943328732913238,\n#             \"distance\": 0.4162980318069458,\n#             \"entity\": {\n#                 \"title\": \"Coronavirus shows what ethical Amazon could look like\",\n#                 \"reading_time\": 4,\n#                 \"claps\": 51\n#             }\n#         }\n#     ]\n# ]\n\n# get collection info\nprint(\"Entity counts: \", collection.num_entities)\n\n# Output\n#\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "# Entity counts:  5979",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 49,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "CCeSdOLrCoIQIVxcGvMcKCI3nab",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "res = await client.search({\n    collection_name: collectionName,\n    vector: rows[0].title_vector,\n    limit: 3,\n    filter: \"claps > 30 and reading_time < 10\",\n    output_fields: [\"title\", \"link\"]\n});\n\nconsole.log(res);\n\n// Output\n// \n// {\n//   status: { error_code: 'Success', reason: '', code: 0 },\n//   results: [\n//     {\n//       score: 0.36103832721710205,\n//       id: '5607',\n//       link: 'https://medium.com/swlh/the-hidden-side-effect-of-the-coronavirus-b6a7a5ee9586',\n//       title: 'The Hidden Side Effect of the Coronavirus'\n//     },\n//     {\n//       score: 0.37674015760421753,\n//       id: '5641',\n//       link: 'https://towardsdatascience.com/why-the-coronavirus-mortality-rate-is-misleading-cc63f571b6a6',\n//       title: 'Why The Coronavirus Mortality Rate is Misleading'\n//     },\n//     {\n//       score: 0.416297972202301,\n//       id: '3441',\n//       link: 'https://medium.com/swlh/coronavirus-shows-what-ethical-amazon-could-look-like-7c80baf2c663',\n//       title: 'Coronavirus shows what ethical Amazon could look like'\n//     }\n//   ]\n// }\n// \n\n// 7. Get collection info\n\nres = await client.describeCollection({\n    collection_name: collectionName\n})\n\nconsole.log(res);\n\n// Output\n// \n// {\n//   virtual_channel_names: [ 'by-dev-rootcoord-dml_11_445311585782773304v0' ],\n//   physical_channel_names: [ 'by-dev-rootcoord-dml_11' ],\n//   aliases: [],\n//   start_positions: [],\n//   properties: [],\n//   status: { error_code: 'Success', reason: '', code: 0 },\n//   schema: {\n//     fields: [ [Object], [Object], [Object] ],\n//     name: 'medium_articles_2020',\n//     description: '',\n//     autoID: false,\n//     enable_dynamic_field: true\n//   },\n//   collectionID: '445311585782773304',\n//   created_timestamp: '445316708672733190',\n//   created_utc_timestamp: '1698748430911',\n//   shards_num: 1,\n//   consistency_level: 'Bounded',\n//   collection_name: 'medium_articles_2020',\n//   db_name: 'default',\n//   num_partitions: '1'\n// }\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "// ",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 30,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "DerDdpWPaorhZfxXirSck60BnEd",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "// prepare query vector\n\nList<List<Float>> queryVectors = new ArrayList<>();\nList<Float> queryVector1 = rows.get(0).getJSONArray(\"title_vector\").toJavaList(Float.class);\nqueryVectors.add(queryVector1);\n\nList<String> outputFields = new ArrayList<>();\noutputFields.add(\"title\");\n// The following two fields are dynamic fields.\noutputFields.add(\"claps\");\noutputFields.add(\"reading_time\");\n\n// Search vectors in a collection\n\nSearchParam searchParam = SearchParam.newBuilder()\n    .withCollectionName(collectionName)\n    .withVectorFieldName(\"title_vector\")\n    .withVectors(queryVectors)\n    .withTopK(5)   \n    .withMetricType(MetricType.L2)  \n    .withParams(\"{\\\"nprobe\\\":10,\\\"offset\\\":2, \\\"limit\\\":3}\")\n    .withOutFields(outputFields)\n    .withExpr(\"$meta[\\\"claps\\\"] > 30 and reading_time < 10\")\n    .build();\n\nR<SearchResults> response = client.search(searchParam);\n\nSearchResultsWrapper wrapper = new SearchResultsWrapper(response.getData().getResults());\n\nList<List<JSONObject>> results = new ArrayList<>();\n\nfor (int i = 0; i < queryVectors.size(); ++i) {\n    List<SearchResultsWrapper.IDScore> scores = wrapper.getIDScore(i);\n    List<JSONObject> entities = new ArrayList<>();\n    for (int j = 0; j < scores.size(); ++j) {\n        SearchResultsWrapper.IDScore score = scores.get(j);\n        JSONObject entity = new JSONObject();\n        entity.put(\"id\", score.getLongID());\n        entity.put(\"distance\", score.getScore());\n        entity.put(\"title\", scores.get(j).get(\"title\"));\n        // The following are dynamic fields.\n        entity.put(\"claps\", scores.get(j).get(\"claps\"));\n        entity.put(\"reading_time\", scores.get(j).get(\"reading_time\"));\n        entities.add(entity);\n    }\n    \n    results.add(entities);\n}\n\nSystem.out.println(results);\n\n// Output:\n// [[\n//     {\n//         \"reading_time\": 6,\n//         \"distance\": 0.494843,\n//         \"id\": 445297206350523266,\n//         \"title\": \"How bad will the Coronavirus Outbreak get? \\u2014 Predicting the outbreak figures\",\n//         \"claps\": 1100\n//     },\n//     {\n//         \"reading_time\": 7,\n//         \"distance\": 0.50522643,\n//         \"id\": 445297206350523757,\n//         \"title\": \"What Does Coronavirus Mean For Your Startup?\",\n//         \"claps\": 111\n//     },\n//     {\n//         \"reading_time\": 4,\n//         \"distance\": 0.50953895,\n//         \"id\": 445297206350524005,\n//         \"title\": \"The Definitive Guide to Leading Remote Work Teams During Coronavirus\",\n//         \"claps\": 753\n//     },\n//     {\n//         \"reading_time\": 6,\n//         \"distance\": 0.53836524,\n//         \"id\": 445297206350523435,\n//         \"title\": \"The Relocation Problem of Field-Calibrated Low-Cost Air Quality Monitoring Systems\",\n//         \"claps\": 51\n//     },\n//     {\n//         \"reading_time\": 7,\n//         \"distance\": 0.57358503,\n//         \"id\": 445297206350523356,\n//         \"title\": \"The Funeral Industry is a Killer\",\n//         \"claps\": 407\n//     }\n// ]]\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 29,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "RmiIdJDgnopSXQx5KOWc7XYPnPe",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "// 8. Search\nfmt.Println(\"Start searching ...\")\n\n// Output: \n//\n// Start searching ...\n\nvectors := []entity.Vector{}\n\nfor _, row := range data.Rows[:1] {\n    vector := make(entity.FloatVector, 0, 768)\n    vector = append(vector, row.TitleVector...)\n    vectors = append(vectors, vector)\n}\n\nsp, _ := entity.NewIndexAUTOINDEXSearchParam(1)\n\nlimit := client.WithLimit(10)\noffset := client.WithOffset(0)\ntopK := 5\noutputFields := []string{\"id\", \"title\", \"claps\", \"reading_time\"}\n\nres, err := conn.Search(\n    context.Background(),               // context\n    COLLNAME,                           // collectionName\n    []string{},                         // partitionNames\n    \"claps > 30 and reading_time < 10\", // expr\n    outputFields,                       // outputFields\n    vectors,                            // vectors\n    \"title_vector\",                     // vectorField\n    entity.MetricType(\"L2\"),            // metricType\n    topK,                               // topK\n    sp,                                 // sp\n    limit,                              // opts\n    offset,                             // opts\n)\n\nif err != nil {\n    log.Fatal(\"Failed to insert rows:\", err.Error())\n}\n\nfmt.Println(resultsToJSON(res))\n\n// Output: \n// [\n//  {\n//      \"counts\": 5,\n//      \"distances\": [\n//          0.36103836,\n//          0.37674016,\n//          0.41629803,\n//          0.4360938,\n//          0.48886314\n//      ],\n//      \"rows\": [\n//          {\n//              \"claps\": 83,\n//              \"id\": 5607,\n//              \"reading_time\": 8,\n//              \"title\": \"The Hidden Side Effect of the Coronavirus\"\n//          },\n//          {\n//              \"claps\": 2900,\n//              \"id\": 5641,\n//              \"reading_time\": 9,\n//              \"title\": \"Why The Coronavirus Mortality Rate is Misleading\"\n//          },\n//          {\n//              \"claps\": 51,\n//              \"id\": 3441,\n//              \"reading_time\": 4,\n//              \"title\": \"Coronavirus shows what ethical Amazon could look like\"\n//          },\n//          {\n//              \"claps\": 65,\n//              \"id\": 938,\n//              \"reading_time\": 6,\n//              \"title\": \"Mortality Rate As an Indicator of an Epidemic Outbreak\"\n//          },\n//          {\n//              \"claps\": 255,\n//              \"id\": 4275,\n//              \"reading_time\": 9,\n//              \"title\": \"How Can AI Help Fight Coronavirus?\"\n//          }\n//      ]\n//  }\n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "// ]",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 22,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "W2VmddAdhoI2c6xZ060clMHHnnc",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "值得注意的是，",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "claps",
                "text_element_style": {
                  "bold": false,
                  "inline_code": true,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": " 和 ",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "reading_time",
                "text_element_style": {
                  "bold": false,
                  "inline_code": true,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": " ",
                "text_element_style": {
                  "bold": true,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "没有预先定义在 Schema 中，但这也并不影响在表达式和输出字段中使用它们。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "Lr6rduwzuo4AcmxnQc8cAwYlnhh",
        "block_type": 2,
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg",
        "text": {
          "elements": [
            {
              "text_run": {
                "content": "如果动态字段包含了除数字、字母及下划线之外的其它特殊字符（如加号、星号或美元符号），我们需要使用",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "$meta[]",
                "text_element_style": {
                  "bold": false,
                  "inline_code": true,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "关键字在表达式或输出字段中引入这些字段。",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        }
      },
      {
        "block_id": "XJ3ndyGxGoa2jPxZRvWcdQ8Yn21",
        "block_type": 14,
        "code": {
          "elements": [
            {
              "text_run": {
                "content": "... \nexpr='$meta[\"#key\"] in [\"a\", \"b\", \"c\"]', \noutput_fields='$meta[\"#key\"]'  \n",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            },
            {
              "text_run": {
                "content": "...",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "language": 49,
            "wrap": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "UtrPdN4GYoAKYJx0jEkcBREFn6f",
        "block_type": 4,
        "heading2": {
          "elements": [
            {
              "text_run": {
                "content": "相关文档{#related-topics}",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "FoWQdC2j2ovyVexaOiAc9nYMnBh",
        "block_type": 12,
        "bullet": {
          "elements": [
            {
              "mention_doc": {
                "obj_type": 16,
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                },
                "title": "创建 Collection",
                "token": "MNcZwAfV6iZxbckfKBlcmCzanti",
                "url": "https://zilliverse.feishu.cn/wiki/MNcZwAfV6iZxbckfKBlcmCzanti"
              }
            },
            {
              "text_run": {
                "content": " ",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "JxV9deFVDoQOwKx0vVucD7uankb",
        "block_type": 12,
        "bullet": {
          "elements": [
            {
              "mention_doc": {
                "obj_type": 16,
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                },
                "title": "使用 Partition Key",
                "token": "DrXpwhU8pixYi9kqzSBcs5TgnFd",
                "url": "https://zilliverse.feishu.cn/wiki/DrXpwhU8pixYi9kqzSBcs5TgnFd"
              }
            },
            {
              "text_run": {
                "content": " ",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      },
      {
        "block_id": "AptBdQNV4o1CDbxnJfRczD82ndQ",
        "block_type": 12,
        "bullet": {
          "elements": [
            {
              "mention_doc": {
                "obj_type": 16,
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                },
                "title": "使用 JSON 类型字段",
                "token": "UXBjwVpKmirzg9kgWgmcLixwnIe",
                "url": "https://zilliverse.feishu.cn/wiki/UXBjwVpKmirzg9kgWgmcLixwnIe"
              }
            },
            {
              "text_run": {
                "content": " ",
                "text_element_style": {
                  "bold": false,
                  "inline_code": false,
                  "italic": false,
                  "strikethrough": false,
                  "underline": false
                }
              }
            }
          ],
          "style": {
            "align": 1,
            "folded": false
          }
        },
        "parent_id": "H7LRdXUf7oGjUyx9IWXcaJ8HnNg"
      }
    ],
    "counts": 39
  }
}