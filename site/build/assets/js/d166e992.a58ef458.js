"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[110],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>g});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(t),m=i,g=d["".concat(s,".").concat(m)]||d[m]||u[m]||r;return t?a.createElement(g,o(o({ref:n},p),{},{components:t})):a.createElement(g,o({ref:n},p))}));function g(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[d]="string"==typeof e?e:i,o[1]=l;for(var c=2;c<r;c++)o[c]=t[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},8181:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var a=t(7462),i=(t(7294),t(3905));const r={slug:"/question-answering-over-documents-with-zilliz-cloud-and-langchain",sidebar_position:0},o="\u4e0e LangChain \u96c6\u6210\u642d\u5efa\u667a\u80fd\u6587\u6863\u95ee\u7b54\u7cfb\u7edf",l={unversionedId:"tutorials/ai-models-integration/open-source-projects/question-answering-over-documents-with-zilliz-cloud-and-langchain",id:"tutorials/ai-models-integration/open-source-projects/question-answering-over-documents-with-zilliz-cloud-and-langchain",title:"\u4e0e LangChain \u96c6\u6210\u642d\u5efa\u667a\u80fd\u6587\u6863\u95ee\u7b54\u7cfb\u7edf",description:"\u672c\u6587\u5c06\u6f14\u793a\u5982\u4f55\u4f7f\u7528 Zilliz Cloud \u548c LangChain \u642d\u5efa\u57fa\u4e8e\u5927\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u7684\u95ee\u7b54\u7cfb\u7edf\u3002\u5728\u672c\u4f8b\u4e2d\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u4e00\u4e2a 1 CU \u7684 Cluster\uff0c\u8fd8\u5c06\u4f7f\u7528 OpenAI \u7684 Embedding API \u6765\u83b7\u53d6\u6307\u5b9a\u6587\u672c\u7684\u5411\u91cf\u8868\u793a\u3002\u73b0\u5728\u5c31\u8ba9\u6211\u4eec\u5f00\u59cb\u5427\u3002",source:"@site/docs/tutorials/ai-models-integration/open-source-projects/question-answering-over-documents-with-zilliz-cloud-and-langchain.md",sourceDirName:"tutorials/ai-models-integration/open-source-projects",slug:"/question-answering-over-documents-with-zilliz-cloud-and-langchain",permalink:"/docs/question-answering-over-documents-with-zilliz-cloud-and-langchain",draft:!1,tags:[],version:"current",sidebarPosition:0,frontMatter:{slug:"/question-answering-over-documents-with-zilliz-cloud-and-langchain",sidebar_position:0},sidebar:"tutorialSidebar",previous:{title:"\u5f00\u6e90\u9879\u76ee",permalink:"/docs/open-source-projects"},next:{title:"\u4e0e PyTorch \u96c6\u6210\u642d\u5efa\u56fe\u7247\u641c\u7d22\u7cfb\u7edf",permalink:"/docs/image-search-with-zilliz-cloud-and-pytorch"}},s={},c=[{value:"\u51c6\u5907\u5de5\u4f5c",id:"some-prep-work",level:2},{value:"\u4e3b\u8981\u53c2\u6570",id:"parameters",level:2},{value:"\u51c6\u5907\u6570\u636e",id:"prepare-data",level:2},{value:"\u5f00\u59cb\u63d0\u95ee",id:"ask-questions",level:2}],p={toc:c},d="wrapper";function u(e){let{components:n,...t}=e;return(0,i.kt)(d,(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u4e0e-langchain-\u96c6\u6210\u642d\u5efa\u667a\u80fd\u6587\u6863\u95ee\u7b54\u7cfb\u7edf"},"\u4e0e LangChain \u96c6\u6210\u642d\u5efa\u667a\u80fd\u6587\u6863\u95ee\u7b54\u7cfb\u7edf"),(0,i.kt)("p",null,"\u672c\u6587\u5c06\u6f14\u793a\u5982\u4f55\u4f7f\u7528 Zilliz Cloud \u548c LangChain \u642d\u5efa\u57fa\u4e8e\u5927\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u7684\u95ee\u7b54\u7cfb\u7edf\u3002\u5728\u672c\u4f8b\u4e2d\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u4e00\u4e2a 1 CU \u7684 Cluster\uff0c\u8fd8\u5c06\u4f7f\u7528 OpenAI \u7684 Embedding API \u6765\u83b7\u53d6\u6307\u5b9a\u6587\u672c\u7684\u5411\u91cf\u8868\u793a\u3002\u73b0\u5728\u5c31\u8ba9\u6211\u4eec\u5f00\u59cb\u5427\u3002"),(0,i.kt)("h2",{id:"some-prep-work"},"\u51c6\u5907\u5de5\u4f5c"),(0,i.kt)("p",null,"\u8fd0\u884c\u672c\u9875\u4e2d\u7684\u811a\u672c\u9700\u8981 ",(0,i.kt)("strong",{parentName:"p"},"pymilvus")," \u548c ",(0,i.kt)("strong",{parentName:"p"},"langchain"),"\u3002\u53e6\u5916\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4f7f\u7528 OpenAI \u7684 Embedding API \u6765\u83b7\u53d6\u6307\u5b9a\u6587\u672c\u7684\u5411\u91cf\u8868\u793a\u5e76\u5c06\u5176\u5b58\u5165\u5411\u91cf\u6570\u636e\u5e93\u4e2d\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u5b89\u88c5 openai \u548c tiktoken\u3002\u5982\u679c\u4f60\u7684\u7cfb\u7edf\u4e2d\u8fd8\u6ca1\u6709\u5b89\u88c5\u8fd9\u4e9b\u4f9d\u8d56\uff0c\u53ef\u4ee5\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"python3 -m pip install --upgrade pymilvus langchain openai tiktoken\n")),(0,i.kt)("h2",{id:"parameters"},"\u4e3b\u8981\u53c2\u6570"),(0,i.kt)("p",null,"\u5728\u8fd9\u4e00\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u9700\u8981\u4e3a\u672c\u9875\u4e2d\u7684\u811a\u672c\u8bbe\u7f6e\u4e00\u4e9b\u516c\u5171\u53c2\u6570\u3002\u8bf7\u6839\u636e\u9700\u8981\u5c06\u5b83\u4eec\u7684\u503c\u4fee\u6539\u6210\u81ea\u5df1\u7684\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'from os import environ\n\nZILLIZ_ENDPOINT = "https://<instance-id>.<cloud-region-id>.vectordb.zillizcloud.com:19535" # example: "in01-17f69c292d4a50a.aws-us-west-2.vectordb.zillizcloud.com"\nZILLIZ_USER = "db_admin" # cluster \u7528\u6237\u540d\nZILLIZ_PASS = "******" # \u4e0a\u8ff0\u7528\u6237\u540d\u5bf9\u5e94\u7684\u5bc6\u7801\nOPENAI_API_KEY = "sk-******" # OpenAI API \u5bc6\u94a5, \u793a\u4f8b: "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"\n\n## Set up environment variables\nenviron["OPENAI_API_KEY"] = OPENAI_API_KEY\n')),(0,i.kt)("h2",{id:"prepare-data"},"\u51c6\u5907\u6570\u636e"),(0,i.kt)("p",null,"\u5728\u5f00\u59cb\u524d\uff0c\u9700\u8981\u5b8c\u6210\u5982\u4e0b\u6b65\u9aa4"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u51c6\u5907\u597d\u9700\u8981\u8ba9\u5927\u8bed\u8a00\u6a21\u578b\u5728\u63a8\u7406\u8fc7\u7a0b\u4e2d\u53c2\u8003\u7684\u6587\u6863\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u642d\u5efa\u597d\u4e00\u4e2a Embedding \u6a21\u578b\u5c06\u8be5\u6587\u6863\u8f6c\u6362\u6210\u5bf9\u5e94\u7684\u5411\u91cf\u8868\u793a\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u642d\u5efa\u597d\u4e00\u4e2a\u5411\u91cf\u6570\u636e\u5e93\u6765\u4fdd\u5b58\u8fd9\u4e9b\u5411\u91cf\u8868\u793a\u3002"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'from langchain.embeddings.openai import OpenAIEmbeddings\nfrom langchain.vectorstores import Milvus\nfrom langchain.document_loaders import WebBaseLoader\nfrom langchain.text_splitter import CharacterTextSplitter\n\n# \u4f7f\u7528 WebBaseLoader \u52a0\u8f7d\u6307\u5b9a\u7684\u9875\u9762\nloader = WebBaseLoader([\n    "https://milvus.io/docs/overview.md",\n])\n\ndocs = loader.load()\n\n# \u4f7f\u7528\u6587\u672c\u5206\u5272\u5668\u5c06\u6587\u6863\u5206\u5272\u6210\u6307\u5b9a\u5927\u5c0f\u7684\u5757\ntext_splitter = CharacterTextSplitter(chunk_size=1024, chunk_overlap=0)\ndocs = text_splitter.split_documents(docs)\n')),(0,i.kt)("p",null,"\u5982\u679c\u6700\u7ec8\u5206\u5272\u7684\u5757\u5927\u5c0f\u5927\u4e8e\u6307\u5b9a\u5927\u5c0f\uff0c\u4f1a\u8f93\u51fa\u5982\u4e0b\u6307\u793a\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"Created a chunk of size 1745, which is longer than the specified 1024\nCreated a chunk of size 1278, which is longer than the specified 1024\n")),(0,i.kt)("p",null,"\u5728\u51c6\u5907\u597d\u6570\u636e\u540e\uff0c\u4e0b\u4e00\u6b65\u5c31\u662f\u5c06\u5b83\u4eec\u8f6c\u6362\u6210\u5bf9\u5e94\u7684\u5411\u91cf\u8868\u793a\uff0c\u5e76\u5c06\u5b83\u4eec\u5b58\u50a8\u5728\u6307\u5b9a\u7684\u5411\u91cf\u6570\u636e\u5e93\u4e2d\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# \u6307\u5b9a\u7528\u6765\u5c06\u6587\u6863\u8f6c\u6362\u6210\u5bf9\u5e94\u5411\u91cf\u8868\u793a\u7684 Embedding \u6a21\u578b\nembeddings = OpenAIEmbeddings(model="ada")\n\n# \u521b\u5efa\u4e00\u4e2a\u5411\u91cf\u6570\u636e\u5e93\u6765\u4fdd\u5b58\u6587\u6863\u7684\u5411\u91cf\u8868\u793a\u3002\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 Zilliz Cloud \u6765\u521b\u5efa\u8be5\u6570\u636e\u5e93\nvector_store = Zilliz.from_documents(\n    docs,\n    embedding=embeddings,\n    connection_args={"uri": ZILLIZ_ENDPOINT, "user": ZILLIZ_USER, "password": ZILLIZ_PASS, "secure": True}\n)\n')),(0,i.kt)("p",null,"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u4ee3\u7801\u8fdb\u884c\u76f8\u4f3c\u6027\u641c\u7d22\u4e86\u3002\u641c\u7d22\u7ed3\u679c\u5c06\u4f1a\u662f\u6587\u6863\u4e2d\u4e0e\u63d0\u95ee\u6700\u76f8\u5173\u7684\u6587\u672c\u5185\u5bb9\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'query = "What is milvus?"\ndocs = vector_store.similarity_search(query)\n\nprint(docs)\n')),(0,i.kt)("p",null,"\u8fd4\u56de\u7684\u7ed3\u679c\u5e94\u4e0e\u5982\u4e0b\u4ee3\u7801\u7c7b\u4f3c\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"[Document(page_content='Milvus workflow.', metadata={'source': 'https://milvus.io/docs/overview.md', 'title': 'Introduction Milvus documentation', 'description': 'Milvus is an open-source vector database designed specifically for AI application development, embeddings similarity search, and MLOps v2.2.x.', 'language': 'en'}), Document(page_content=\"Installat...rved.\", metadata={'source': 'https://milvus.io/docs/overview.md', 'title': 'Introduction Milvus documentation', 'description': 'Milvus is an open-source vector database designed specifically for AI application development, embeddings similarity search, and MLOps v2.2.x.', 'language': 'en'}), Document(page_content='Introduction ... Milvus is able to analyze the correlation between two vectors by calculating their similarity distance. If the two embedding vectors are very similar, it means that the original data sources are similar as well.', metadata={'source': 'https://milvus.io/docs/overview.md', 'title': 'Introduction Milvus documentation', 'description': 'Milvus is an open-source vector database designed specifically for AI application development, embeddings similarity search, and MLOps v2.2.x.', 'language': 'en'}), Document(page_content=\"Key concepts\\n...search algorithms are used to accelerate the searching process. If the two embedding vectors are very similar, it means that the original data sources are similar as well.\\nWhy Milvus?\", metadata={'source': 'https://milvus.io/docs/overview.md', 'title': 'Introduction Milvus documentation', 'description': 'Milvus is an open-source vector database designed specifically for AI application development, embeddings similarity search, and MLOps v2.2.x.', 'language': 'en'})]\n")),(0,i.kt)("h2",{id:"ask-questions"},"\u5f00\u59cb\u63d0\u95ee"),(0,i.kt)("p",null,"\u5728\u51c6\u5907\u597d\u6587\u6863\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u6761 Stuff \u94fe\u5c06\u6587\u6863\u5305\u542b\u5728\u4e00\u4e2a\u63d0\u793a\u8bcd\u4e2d\u5e76\u5c06\u8be5\u63d0\u793a\u8bcd\u5582\u7ed9\u5927\u8bed\u8a00\u6a21\u578b\u3002\u8fd9\u6837\u5927\u8bed\u8a00\u6a21\u578b\u5c31\u53ef\u4ee5\u5728\u56de\u7b54\u6211\u4eec\u7684\u63d0\u95ee\u65f6\u53c2\u8003\u6587\u6863\u4e2d\u7684\u5185\u5bb9\u3002"),(0,i.kt)("admonition",{title:"\u6ce8\u610f",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"LangChain \u63d0\u4f9b\u4e86\u56db\u79cd\u7528\u4e8e\u642d\u5efa\u6307\u5b9a\u6e90\u95ee\u7b54\u7684\u94fe\uff0c\u5b83\u4eec\u5206\u522b\u662f Stuff \u94fe\uff0cMapReduce \u94fe\uff0cRefine \u94fe \u548c MapRerank \u94fe\u3002\n\u7b80\u5355\u6765\u8bf4\uff0cStuff \u94fe\u4f1a\u5c06\u6574\u4e2a\u6587\u6863\u5305\u542b\u5728\u63d0\u793a\u8bcd\u4e2d\u3002\u56e0\u6b64\uff0c\u5b83\u53ea\u9002\u7528\u4e8e\u6587\u6863\u89c4\u6a21\u8f83\u5c0f\u7684\u573a\u666f\u3002\u5927\u591a\u6570\u5927\u8bed\u8a00\u6a21\u578b\u5bf9\u4e00\u6761\u63d0\u793a\u8bcd\u53ef\u4ee5\u5305\u542b\u7684\u7b26\u53f7\u6570\u91cf\u6709\u6570\u91cf\u9650\u5236\uff0c\u56e0\u6b64\u5efa\u8bae\u4f7f\u7528\u5176\u5b83\u4e09\u79cd\u94fe\u3002\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u521b\u5efa\u597d\u7684\u94fe\u5c06\u6587\u6863\u5206\u5272\u6210\u5408\u9002\u5927\u5c0f\u7684\u5757\u5e76\u901a\u8fc7\u4e0d\u540c\u7684\u65b9\u5f0f\u5c06\u5b83\u4eec\u5582\u7ed9\u5927\u8bed\u8a00\u6a21\u578b\u3002\u60f3\u4e86\u89e3\u66f4\u591a\uff0c\u53ef\u4ee5\u53c2\u8003 LangChain \u6587\u6863\u91cc\u5173\u4e8e",(0,i.kt)("a",{parentName:"p",href:"https://docs.langchain.com/docs/components/chains/index_related_chains"},"\u7d22\u5f15\u94fe"),"\u7684\u76f8\u5173\u63cf\u8ff0\u3002")),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u811a\u672c\u4f1a\u4ee5OpenAI\u4e3a\u76ee\u6807\u5927\u8bed\u8a00\u6a21\u578b\u521b\u5efa\u4e00\u6761MapReduce\u7c7b\u578b\u7684\u94fe\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'from langchain.chains.qa_with_sources import load_qa_with_sources_chain\nfrom langchain.llms import OpenAI\n\nchain = load_qa_with_sources_chain(OpenAI(temperature=0), chain_type="map_reduce", return_intermediate_steps=True)\nquery = "When was milvus created?"\nchain({"input_documents": docs, "question": query}, return_only_outputs=True)\n')),(0,i.kt)("p",null,"\u8fd4\u56de\u7684\u7ed3\u679c\u5305\u542b\u4e86\u4e2d\u95f4\u6b65\u9aa4\uff08 ",(0,i.kt)("inlineCode",{parentName:"p"},"intermediate_steps")," \uff09\u548c\u8f93\u51fa\u6587\u672c ( ",(0,i.kt)("inlineCode",{parentName:"p"},"output_text")," )\u4e24\u4e2a\u90e8\u5206\u3002\u524d\u8005\u7528\u4e8e\u8868\u660e\u5728\u641c\u7d22\u8fc7\u7a0b\u4e2d\u53c2\u8003\u7684\u6587\u6863\uff0c\u540e\u8005\u5219\u662f\u5bf9\u7528\u6237\u63d0\u95ee\u7684\u56de\u7b54\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"{'intermediate_steps': [' No relevant text.',\n  ' Milvus was created in 2019 with a singular goal: store, index, and manage massive embedding vectors generated by deep neural networks and other machine learning (ML) models.',\n  ' Milvus. 2023 All rights reserved.',\n  ' None'],\n 'output_text': ' Milvus was created in 2019.\\nSOURCES: https://milvus.io/docs/overview.md'}\n")))}u.isMDXComponent=!0}}]);