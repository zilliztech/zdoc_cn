---
slug: /批量插入数据
sidebar_position: 2
---

# 批量插入数据

本文介绍如何将数据批量插入到 Collection。

## 开始前 {#before-commencing}

请确保已完成以下步骤：

- 已创建集群。详情请参见[创建集群](./create-cluster)。

- 已下载示例数据集。详情请参见[示例数据集](./example-dataset-1)。

- 已创建 Collection，且该 Collection 的 Schema 与示例数据集相匹配。已为该 Collection 创建索引，并已加载 Collection。详情请参见[定制 Schema](./use-customized-schema)。

## 准备数据文件 {#preparing-data-files}

将数据导入 Collection 之前，应先将数据整理为基于行的 JSON 文件或多个 NumPy 文件。[示例数据集](./example-dataset-1)是基于行的 JSON 文件，可以直接用于完成接下来的步骤。

若要使用 NumPy 文件，可参考以下代码将 JSON 文件转换为多个 NumPy 文件：

```python
import json
import numpy

with open('path/to/medium_articles_2020_dpr.json') as f:
    dataset = json.load(f)
    keys = dataset['rows'][0].keys()

    for key in keys:
        numpy.save(f'{key}.npy', numpy.array([ x[key] for x in dataset['rows'] ]))

    # For JSON fields, you should dump the field values before saving them
    # numpy.save(f'json_field.npy', numpy.array([
    #     json.dumps({"year": 2015, "price": 23.43}),
    #     json.dumps({"year": 2018, "price": 15.05}),
    #     json.dumps({"year": 2020, "price": 36.68}),
    #     json.dumps({"year": 2019, "price": 20.14}),
    #     json.dumps({"year": 2021, "price": 9.36}))
    # ]))
```

## 通过控制台导入数据 {#import-data-through-the-console}

数据文件准备就绪后，可以直接从本地导入，也可以将文件上传到对象存储桶（如阿里云 OSS）进行导入。

:::info 说明

数据文件所在的对象存储桶应与集群位于同一云上。否则，导入可能会失败。

:::

- 从本地文件导入
  您只需将本地文件拖放到文件上传区域，或点击**点击上传**并选择目标文件即可开始导入。

  若要导入 NumPy 文件，需先将文件上传到对象存储桶。具体操作可参考[下文](https://zilliverse.feishu.cn/docx/WexbdEMOwodYYoxmu5nccUfHn7f#RtZQdKFu8o2tl0xOovOcyKMWnpc)。

  ![import_data_from_local_files](/img/import_data_from_local_files.png)

- 从 OSS 对象存储导入
  要从 OSS 对象存储导入数据，必须先将数据文件上传到存储桶。您可以将一个 JSON 文件或一组NumPy 文件上传到存储桶。上传完成后，请填写文件 URL 和访问密钥，以便 Zilliz Cloud 从存储桶中提取数据。

  有关如何获取文件 URL 和访问密钥，请参见[获取单个或多个文件的 URL](https://help.aliyun.com/zh/oss/user-guide/how-to-obtain-the-url-of-a-single-object-or-the-urls-of-multiple-objects?spm=a2c4g.11186623.0.i18) 和[创建 Access Key](https://help.aliyun.com/document_detail/53045.html?spm=a2c4g.53045.0.0.718a7f80sYRRJB)。 

  ![import_data_from_object_storage](/img/import_data_from_object_storage.png)

## 通过 RESTful API 导入数据 {#import-data-via-restful-api}

除了[通过控制台导入](https://zilliverse.feishu.cn/docx/WexbdEMOwodYYoxmu5nccUfHn7f#GGe2dK4Jsok5OWxCz8KcaBJKn5g)，Zilliz Cloud 也支持通过 RESTful API 导入数据。调用 RESTful API 之前，请确保已完成以下步骤：

- 数据文件已上传至 OSS 对象存储。

- 已获取数据文件的 URL。有关如何获取文件 URL，请参见[获取单个或多个文件的 URL](https://help.aliyun.com/zh/oss/user-guide/how-to-obtain-the-url-of-a-single-object-or-the-urls-of-multiple-objects?spm=a2c4g.11186623.0.i18)。 

- 已获取 Zilliz Cloud 集群的 [API 密钥](./manage-api-keys)。

文件准备就绪后，可以参考以下代码调用 API：

```shell
curl --request POST \
     --url "https://controller.api.${CLOUD_REGION_ID}.zillizcloud.com/v1/vector/collections/import" \
     --header "Authorization: Bearer ${TOKEN}" \
     --header "accept: application/json" \
     --header "content-type: application/json" \
     -d '{
       "clusterId": "${CLUSTER_ID}",
       "collectionName": "medium_articles",
       "objectUrl": "gs://publicdataset-zillizcloud-com/medium_articles_2020.json"
       "accessKey": "your-access-key"
       "secretKey": "your-secret-key"
     }'
```

以上代码中，请将 `{CLOUD_REGION_ID}`, `{TOKEN}`, 和 `{CLUSTER_ID}` 替换为实际值。请求提交后，会返回任务 ID。

您可以通过任务 ID 查询导入进度：

```shell
curl --request GET \
     --url "https://controller.api.${CLOUD_REGION_ID}.zillizcloud.com/v1/vector/collections/import/get?jobId=${JOBID}&clusterId=${CLUSTERID}" \
     --header "Authorization: Bearer ${TOKEN}" \
     --header "accept: application/json" \
     --header "content-type: application/json" \
```

## 结果验证 {#result-verification}

单击**导入**后，后台开始导入数据，您可以实时查看导入进度。

![data_import_progress](/img/data_import_progress.png)

数据导入完成后，您会收到以下提示。之后，您可以点击**立即导入**，继续从其他文件中导入数据，或开始探索已导入的数据。

![data_import_complete](/img/data_import_complete.png)

