---
slug: /setup-a-private-link
beta: FALSE
notebook: FALSE
token: JLHPwhdssifn2dkR5lDcA4SWnVg
sidebar_position: 2
---

import Admonition from '@theme/Admonition';


# 创建私网连接

Zilliz Cloud 允许您通过私网连接（PrivateLink）访问您的集群。如果您不希望通过公众互联网访问您位于 Zilliz Cloud 上的集群， 可以按照本章的步骤为您的集群创建私网连接。

## 配置思路{configuration-principle}{#configuration-principle}

![private_link_cn](/img/private_link_cn.png)

如上图所示，私网连接建立在您的应用所在 VPC 与 您的 Zilliz Cloud 集群所在VPC 之间。 Zilliz Cloud 集群提供的私网连接支持为多个可用区的应用提供服务。如需启用访问 Zilliz Cloud 集群的私网连接，您需要：

- 通过阿里云控制台在您的 VPC 中创建一个终端节点，并为其选择安全组、可用区和交换机。

- 将上述信息提交给 Zilliz Cloud 注册私网连接。Zilliz Cloud 将根据提交的信息为您的集群分配一个域名前缀。

- 前往阿里云控制台，使用该域名前缀创建一条私网解析记录。

## 前提条件{#before-you-start}{#before-you-start}

- 您已经注册了 Zilliz Cloud。

- 您已经创建了集群。

## 配置步骤{#procedures}{#procedures}

本节将按照配置思路详细介绍如何为您的 Zilliz Cloud 集群创建私网连接。

### 登记私网连接参数{#set-private-link-parameters}{#set-private-link-parameters}

1. 登录Zilliz Cloud，并在左侧导航栏顶部的下拉菜单中选择合适的项目。

1. 在项目左侧导航栏中选择**安全** > **私网连接**，并单击**创建私网连接**。

    您还可以在**集群详情**页面中的**连接信息**区域中单击**创建私网连接**。

1. 在弹出的**创建私网连接**对话框中，填写**云服务提供商**、**云服务地域**、**主帐号 ID**。

    |  **参数名称**   |  **参数描述**                                                                                                                                     |
    | ----------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
    |  **云服务提供商** |  与私网连接访问目标集群所在网络保持一致。<br/> <br/>  在**集群详情**页面中的**集群信息**区域中，可查看当前集群的**地域**及详情。                                                                   |
    |  **云服务地域**  |  与私网连接访问目标集群所在网络保持一致。                                                                                                                         |
    |  **主帐号 ID** |  填写您的阿里云主帐号 ID，并单击**添加**提交验证。<br/> <br/>  请使用阿里云主帐号登录阿里云。登录后，鼠标悬停右上角头像区域，可查看当前登录的主帐号及其 ID。<br/> <br/>  验证通过后，在创建终端节点时才能够查看到 Zilliz Cloud 的终端节点服务。 |

    <Admonition type="info" icon="📘" title="说明">

    - 在填写完阿里云**主帐号 ID** 后，务必单击右侧的**添加**。    
    
        验证通过后，在创建终端节点时才能够在可用服务列表中查看到 Zilliz Cloud 的终端节点服务。    
    
    - 操作尚未完成！请勿单击对话框中的**创建**。    
    
        您需要前往阿里云控制台，[创建终端节点](./setup-a-private-link#create-endpoint)。然后，在对话框中填写成功创建的**终端节点实例 ID **后，才可以单击**创建**。

    </Admonition>

### 创建终端节点{#create-endpoint}{#create-endpoint}

1. 登录阿里云，前往[**专有网络**](https://vpc.console.aliyun.com/endpoint/cn-hangzhou/endpoints)[ > ](https://vpc.console.aliyun.com/endpoint/cn-hangzhou/endpoints)[**终端节点](https://vpc.console.aliyun.com/endpoint/cn-hangzhou/endpoints)。**

1. 在**接口终端节点**页签中单击**创建终端节点**。

    如果尚未开通私网连接服务。请先单击**开通私网连接服务**后，再执行本操作。

1. 在**创建终端节点**页面，填写如下内容。

    |  **参数名称**    |  **参数描述**                                                                                                                                                                                                                                                                |
    | ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
    |  **所属地域**    |  填写私网连接目标集群所在地域。                                                                                                                                                                                                                                                         |
    |  **节点名称**    |  为该节点命名。                                                                                                                                                                                                                                                                 |
    |  **终端节点类型**  |  选择**接口终端节点**。                                                                                                                                                                                                                                                           |
    |  **终端节点服务**  |  选择**可用服务**。<br/> <br/>  如果您在上一步中添加的阿里云主帐号通过验证后，可用服务列表中将展示该主帐号对应的 Zilliz Cloud 服务。                                                                                                                                                                                         |
    |  **专有网络**    |  选择需要使用私网连接访问 Zilliz Cloud 集群的服务所在 VPC。                                                                                                                                                                                                                                  |
    |  **安全组**     |  选择应用于该终端节点的安全组规则。<br/> <br/>  如第一次使用，建议新建安全组，规划如下：<br/> <br/>  - **网络**<br/> <br/>      选择需要使用私网连接访问 Zilliz Cloud 集群的服务所在 VPC。<br/> <br/>  - **访问规则**<br/> <br/>      添加一条**协议类型**为 **TCP**，**端口范围**为 Zilliz Cloud 集群暴露的端口，**授权对象**为 **0.0.0.0/0 **的访问规则。建议添加一条 ICMP 规则用于网络连通性排查。 |
    |  **可用区与交换机** |  选择 Zilliz Cloud 集群所在可用区并创建默认交换机。<br/> <br/>  目前，Zilliz Cloud 集群可选可用区有 H，J，K。交换机配置无特殊要求，保持默认即可。                                                                                                                                                                            |

1. 填写完所有信息后，单击**确认创建**。

1. 确认终端节点创建成功后，复制创建好的实例 ID 备用。

    此时，**可用区与网卡**页签中显示的可用区**状态**为**等待连接**，**服务状态**为**异常**。

### 创建私网连接{#create-private-link}{#create-private-link}

1. 返回 Zilliz Cloud，将复制好的终端节点实例 ID 填入**创建私网连接**对话框中的**终端节点实例 ID **字段中。

1. 单击**创建**后，Zilliz Cloud 将开始创建私网连接。

    创建私网连接耗时较长，请耐心等待。创建完成后，可在私网连接页面查看 Zilliz Cloud 分配的 **Endpoint 服务名称**、 **Endpoint 服务状态**和**私网连接**前缀。

1. 返回阿里云控制台，检查已创建的终端节点实例，并复制可用区的** IP 地址**备用。

    此时，终端节点实例的**可用区与网卡**页签中显示的可用区**状态**变更为**已连接**，**服务状态**变更为**正常**。

### 添加私域解析记录{#add-private-zone-record}{#add-private-zone-record}

1. 返回阿里云控制台，前往[**私域解析**](https://dns.console.aliyun.com/#/privateZone/list)。

    首次打开该页面时，需要单击**立即开通**启用私域解析服务。开通完成后，刷新页面可进入私域解析记录列表。

1. 单击**添加 Zone**，在弹出的**添加 PrivateZone **对话框中填写 **Zone名称**，并勾选**子域名递归解析代理**。单击**确定**后，列表中出现一条新记录。

    当前阿里云上 Zilliz Cloud 集群所属 Zone 名称为 **ali-cn-hangzhou.vectordb.zilliz.com.cn**。

1. 在该记录的**操作**栏中单击**解析设置**。

    1. 在**解析设置**页签中单击**添加记录**。

    1. 在弹出的**添加记录**对话框中输入如下内容。

        |  **参数名称** |  **参数描述**                         |
        | --------- | --------------------------------- |
        |  **记录类型** |  选择将域名指向一个 IPV4 地址的 A 记录。         |
        |  **主机记录** |  请填写 Zilliz Cloud 提供的的**私网连接**前缀。 |
        |  **记录值**  |  请填写终端节点实例详情中可用区的 IP 地址。          |
        |  **TTL值** |  保持默认即可。                          |

    1. 单击**确定**，保存设置。

1. 返回[**私域解析**](https://dns.console.aliyun.com/#/privateZone/list)页面，在当前 Zone 记录的操作栏中单击**关联VPC**。

    1. 在右侧滑出的关联 VPC 对话框中选择需要使用私网连接访问 Zilliz Cloud 集群的服务所在 VPC。

    1. 单击**确定**，保存设置。

1. 返回[**私域解析**](https://dns.console.aliyun.com/#/privateZone/list)页面。此时，当前 Zone 记录的**关联VPC状态**已变更为**已关联**。

## 后续操作{next-steps}{#next-steps}

在私网连接创建完成后，可按照集群详情页面右上角的连接指南使用私网连接进行连通性验证。